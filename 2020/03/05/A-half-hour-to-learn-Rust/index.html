<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  
  <title>Rust半小时教程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文: A half-hour to learn Rust
为了熟练的掌握一门编程语言，人们不得不阅读它的大量的相关资料。但是如果你不理解这些资料介绍的内容，如何能学习更多的资料呢？在本文中，我将尽可能多地列举Rust代码片段，并解释它们包含的关键字和符号的含义，而不是只关注Rust的一两个概念。
准备好了吗，让我们出发吧!">
<meta property="og:type" content="article">
<meta property="og:title" content="Rust半小时教程">
<meta property="og:url" content="https://colobu.com/2020/03/05/A-half-hour-to-learn-Rust/">
<meta property="og:site_name" content="鸟窝">
<meta property="og:description" content="原文: A half-hour to learn Rust
为了熟练的掌握一门编程语言，人们不得不阅读它的大量的相关资料。但是如果你不理解这些资料介绍的内容，如何能学习更多的资料呢？在本文中，我将尽可能多地列举Rust代码片段，并解释它们包含的关键字和符号的含义，而不是只关注Rust的一两个概念。
准备好了吗，让我们出发吧!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rust半小时教程">
<meta name="twitter:description" content="原文: A half-hour to learn Rust
为了熟练的掌握一门编程语言，人们不得不阅读它的大量的相关资料。但是如果你不理解这些资料介绍的内容，如何能学习更多的资料呢？在本文中，我将尽可能多地列举Rust代码片段，并解释它们包含的关键字和符号的含义，而不是只关注Rust的一两个概念。
准备好了吗，让我们出发吧!">

  
  <link rel="alternative" href="/atom.xml" title="鸟窝" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <link href="//cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/css/jquery.fancybox.min.css"
    media="screen" type="text/css">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" media="screen"
    type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap" class="animated bounceInLeft">
        <a href="/" id="logo">鸟窝</a>
      </h1>
      
        <h2 id="subtitle-wrap" class="animated bounceInLeft">
          <a href="/" id="subtitle">大道至简 Simplicity is the ultimate form of sophistication</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class="fa fa-home">&nbsp;</i>首页</a>
          
          
          
            <a class="main-nav-link" href="/archives"><i class="fa fa-folder-o">&nbsp;</i>归档</a>
          
          
          
            <a class="main-nav-link" href="https://github.com/smallnest"><i class="fa fa-github">&nbsp;</i>github</a>
          
          
          
            <div class="dropdown main-nav-link"><a class="main-nav-link" href="#"><i class="fa fa-bars">&nbsp;</i>网站群</a>
              <div class="dropdown-content">
          
            
              <a href="/goasm"><i class="fa fa-language"></i>&nbsp;Go汇编示例</a>
            
                
          
            
              <a href="https://gowebexamples.com"><i class="fa fa-external-link"></i>&nbsp;Go Web开发示例</a>
            
                
          
            
              <a href="http://go-database-sql.org"><i class="fa fa-external-link"></i>&nbsp;Go 数据库开发教程</a>
            
                
          
            
              <hr>
            
                
          
            
              <a href="http://rpcx.io"><i class="fa undefined"></i>&nbsp;RPCX官网</a>
            
                
          
            
              <a href="http://cn.doc.rpcx.io"><i class="fa undefined"></i>&nbsp;RPC开发指南</a>
            
                
          
          </div>
        </div>
          
          
          
            <a class="main-nav-link" href="/ScalaCollectionsCookbook"><i class="fa fa-book">&nbsp;</i>Scala集合技术手册</a>
          
          
          
            <a class="main-nav-link" href="/about"><i class="fa fa-lemon-o">&nbsp;</i>关于</a>
          
          


      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="https://www.google.com/search" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" id="search-word" name="q" maxlength="20" class="search-form-input" placeholder="Search">
          <input type=hidden name=ie value="utf-8">
          <input type=hidden name=oe value="utf-8">
          <input type=hidden name=hl value="zh-CN">
          <input type="submit" id="search-submit" value="" class="search-form-submit">
        </form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-A-half-hour-to-learn-Rust" class="article article-type-post" itemscope
  itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/05/A-half-hour-to-learn-Rust/" class="article-date">
  <time datetime="2020-03-05T06:08:38.000Z" itemprop="datePublished">2020年03月05日</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Rust/">Rust</a>
  </div>

    
  <div class="article-author"> by Amos</div>

  </div>
  <div class="article-inner">
    
    
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      Rust半小时教程
	  
    </h1>
  

    </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      
      
      <script>function show_answer(btn, x) { if (btn.value === "显示答案") { btn.value = "隐藏答案" } else { btn.value = "显示答案" } var as = document.getElementById(x); if (as.style.display === "none") { as.style.display = "block" } else { as.style.display = "none" } }</script>
      <p>原文: <a href="https://fasterthanli.me/blog/2020/a-half-hour-to-learn-rust/" target="_blank" rel="external">A half-hour to learn Rust</a></p>
<p>为了熟练的掌握一门编程语言，人们不得不阅读它的大量的相关资料。但是如果你不理解这些资料介绍的内容，如何能学习更多的资料呢？<br>在本文中，我将尽可能多地列举Rust代码片段，并解释它们包含的关键字和符号的含义，而不是只关注Rust的一两个概念。</p>
<p>准备好了吗，让我们出发吧!</p>
<a id="more"></a>
<p><code>let</code> 引入变量</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x; <span class="comment">// declare "x"</span></div><div class="line">x = <span class="number">42</span>; <span class="comment">// assign 42 to "x"</span></div></pre></td></tr></table></figure>

<p>也可以写成一行:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">42</span>;</div></pre></td></tr></table></figure>

<p>你可以使用<code>:</code>显式地指定变量的类型，也就是类型注解：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x: <span class="keyword">i32</span>; <span class="comment">// `i32` is a signed 32-bit integer</span></div><div class="line">x = <span class="number">42</span>;</div><div class="line"></div><div class="line"><span class="comment">// there's i8, i16, i32, i64, i128</span></div><div class="line"><span class="comment">// also u8, u16, u32, u64, u128 for unsigned</span></div></pre></td></tr></table></figure>

<p>也可以写成一行:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x: <span class="keyword">i32</span> = <span class="number">42</span>;</div></pre></td></tr></table></figure>

<p>如果你声明一个变量，后来再初始化它。在初始化之前使用它的话编译器会报错:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x;</div><div class="line">foobar(x); <span class="comment">// error: borrow of possibly-uninitialized variable: `x`</span></div><div class="line">x = <span class="number">42</span>;</div></pre></td></tr></table></figure>

<p>下面的代码就可以了:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x;</div><div class="line">x = <span class="number">42</span>;</div><div class="line">foobar(x); <span class="comment">// the type of `x` will be inferred from here</span></div></pre></td></tr></table></figure>

<p>下划线<code>_</code>是一个特殊的名字，或者更确切地说，“缺乏名字”。基本上它的意思就是扔掉一些东西:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// this does *nothing* because 42 is a constant</span></div><div class="line"><span class="keyword">let</span> <span class="number">_</span> = <span class="number">42</span>;</div><div class="line"></div><div class="line"><span class="comment">// this calls `get_thing` but throws away its result</span></div><div class="line"><span class="keyword">let</span> <span class="number">_</span> = get_thing();</div></pre></td></tr></table></figure>

<p>以下划线开头的名称是常规名称，有一点特殊，就是如果它们未被使用的话编译器不会报警告:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// we may use `_x` eventually, but our code is a work-in-progress</span></div><div class="line"><span class="comment">// and we just wanted to get rid of a compiler warning for now.</span></div><div class="line"><span class="keyword">let</span> <span class="number">_</span>x = <span class="number">42</span>;</div></pre></td></tr></table></figure>

<p>变量名可以重用-它会隐藏(shadow)前一个变量:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">13</span>;</div><div class="line"><span class="keyword">let</span> x = x + <span class="number">3</span>;</div><div class="line"><span class="comment">// using `x` after that line only refers to the second `x`,</span></div><div class="line"><span class="comment">// the first `x` no longer exists.</span></div></pre></td></tr></table></figure>

<p>Rust有<a href="https://doc.rust-lang.org/std/primitive.tuple.html" target="_blank" rel="external">tuple类型</a>，你可以把它看作有固定长度的不同类型的集合:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> pair = (<span class="string">'a'</span>, <span class="number">17</span>);</div><div class="line">pair.<span class="number">0</span>; <span class="comment">// this is 'a'</span></div><div class="line">pair.<span class="number">1</span>; <span class="comment">// this is 17</span></div></pre></td></tr></table></figure>

<p>如果我们想为tuple加上类型注解，可以这么做:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> pair: (<span class="keyword">char</span>, <span class="keyword">i32</span>) = (<span class="string">'a'</span>, <span class="number">17</span>);</div></pre></td></tr></table></figure>

<p>Tuple类型可以通过赋值方式进行解构(destructured)，这意味着它们被分成各自独立的字段:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> (some_char, some_int) = (<span class="string">'a'</span>, <span class="number">17</span>);</div><div class="line"><span class="comment">// now, `some_char` is 'a', and `some_int` is 17</span></div></pre></td></tr></table></figure>

<p>当一个函数返回tuple类型的时候特别管用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> (left, right) = slice.split_at(middle);</div></pre></td></tr></table></figure>

<p>当然，解构一个tuple的时候，下划线<code>_</code>可以用来丢掉一些字段:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> (<span class="number">_</span>, right) = slice.split_at(middle);</div></pre></td></tr></table></figure>

<p>分号<code>;</code>放在语句(statement)的结尾:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">3</span>;</div><div class="line"><span class="keyword">let</span> y = <span class="number">5</span>;</div><div class="line"><span class="keyword">let</span> z = y + x;</div></pre></td></tr></table></figure>

<p>这意味着语句可以写成多行:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</div><div class="line">    .iter()</div><div class="line">    .map(|x| x + <span class="number">3</span>)</div><div class="line">    .fold(<span class="number">0</span>, |x, y| x + y);</div></pre></td></tr></table></figure>

<p>(之后我们再介绍这段代码的意义)</p>
<p><code>fn</code>用来声明一个函数。<br>下面是一个void函数:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">greet</span></span>() {</div><div class="line">    println!(<span class="string">"Hi there!"</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面是一个返回32位有符号的整数，箭头指示它的返回类型:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">fair_dice_roll</span></span>() -&gt; <span class="keyword">i32</span> {</div><div class="line">    <span class="number">4</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>一对大括号声明了代码块(block),块有自己的作用域:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// This prints "in", then "out"</span></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x = <span class="string">"out"</span>;</div><div class="line">    {</div><div class="line">        <span class="comment">// this is a different `x`</span></div><div class="line">        <span class="keyword">let</span> x = <span class="string">"in"</span>;</div><div class="line">        println!(x);</div><div class="line">    }</div><div class="line">    println!(x);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>块也是表达式，意味着它的计算结果是一个值:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// this:</span></div><div class="line"><span class="keyword">let</span> x = <span class="number">42</span>;</div><div class="line"></div><div class="line"><span class="comment">// is equivalent to this:</span></div><div class="line"><span class="keyword">let</span> x = { <span class="number">42</span> };</div></pre></td></tr></table></figure>

<p>块可以包括多条语句:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = {</div><div class="line">    <span class="keyword">let</span> y = <span class="number">1</span>; <span class="comment">// first statement</span></div><div class="line">    <span class="keyword">let</span> z = <span class="number">2</span>; <span class="comment">// second statement</span></div><div class="line">    y + z <span class="comment">// this is the *tail* - what the whole block will evaluate to</span></div><div class="line">};</div></pre></td></tr></table></figure>

<p>函数块的最后省略分号意味着返回这个值，例如下面两个函数功能是一样的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">fair_dice_roll</span></span>() -&gt; <span class="keyword">i32</span> {</div><div class="line">    <span class="keyword">return</span> <span class="number">4</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">fair_dice_roll</span></span>() -&gt; <span class="keyword">i32</span> {</div><div class="line">    <span class="number">4</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>if</code>条件也可以是表达式:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">fair_dice_roll</span></span>() -&gt; <span class="keyword">i32</span> {</div><div class="line">    <span class="keyword">if</span> feeling_lucky {</div><div class="line">        <span class="number">6</span></div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        <span class="number">4</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>match</code>也是表达式:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">fair_dice_roll</span></span>() -&gt; <span class="keyword">i32</span> {</div><div class="line">    <span class="keyword">match</span> feeling_lucky {</div><div class="line">        <span class="keyword">true</span> =&gt; <span class="number">6</span>,</div><div class="line">        <span class="keyword">false</span> =&gt; <span class="number">4</span>,</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>点号(<code>.</code>)用来访问一个值的字段:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = (<span class="number">10</span>, <span class="number">20</span>);</div><div class="line">a.<span class="number">0</span>; <span class="comment">// this is 10</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> amos = get_some_struct();</div><div class="line">amos.nickname; <span class="comment">// this is "fasterthanlime"</span></div></pre></td></tr></table></figure>

<p>或者调用一个方法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nick = <span class="string">"fasterthanlime"</span>;</div><div class="line">nick.len(); <span class="comment">// this is 14</span></div></pre></td></tr></table></figure>

<p>双冒号(<code>::</code>)类似点号但是操作的对象是命名空间。<br>下面的例子中<code>std</code>是一个crate(库)，<code>cmp</code>是一个模块(<code>module</code>， 源文件)，<code>min</code>是一个函数:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> least = std::cmp::min(<span class="number">3</span>, <span class="number">8</span>); <span class="comment">// this is 3</span></div></pre></td></tr></table></figure>

<p><code>use</code>指令将其它命名空间的名称引入到当前:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> std::cmp::min;</div><div class="line"></div><div class="line"><span class="keyword">let</span> least = min(<span class="number">7</span>, <span class="number">1</span>); <span class="comment">// this is 1</span></div></pre></td></tr></table></figure>

<p>使用<code>use</code>指令的时候，大括号意味着一组名称(<code>glob</code>)。如果我们想同时引入<code>max</code>和<code>min</code>，我们可以这么做:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// this works:</span></div><div class="line"><span class="keyword">use</span> std::cmp::min;</div><div class="line"><span class="keyword">use</span> std::cmp::max;</div><div class="line"></div><div class="line"><span class="comment">// this also works:</span></div><div class="line"><span class="keyword">use</span> std::cmp::{min, max};</div><div class="line"></div><div class="line"><span class="comment">// this also works!</span></div><div class="line"><span class="keyword">use</span> std::{cmp::min, cmp::max};</div></pre></td></tr></table></figure>

<p>通配符<code>*</code>引入命名空间下的所有的名称:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// this brings `min` and `max` in scope, and many other things</span></div><div class="line"><span class="keyword">use</span> std::cmp::*;</div></pre></td></tr></table></figure>

<p>类型也是命名空间，它们的方法也可以通过普通函数一样调用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="string">"amos"</span>.len(); <span class="comment">// this is 4</span></div><div class="line"><span class="keyword">let</span> x = str::len(<span class="string">"amos"</span>); <span class="comment">// this is also 4</span></div></pre></td></tr></table></figure>

<p><code>str</code>是一个基本类型(primitive type),但是在默认的命名空间下也有很多非基本类型:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `Vec` is a regular struct, not a primitive type</span></div><div class="line"><span class="keyword">let</span> v = Vec::new();</div><div class="line"></div><div class="line"><span class="comment">// this is exactly the same code, but with the *full* path to `Vec`</span></div><div class="line"><span class="keyword">let</span> v = std::vec::Vec::new();</div></pre></td></tr></table></figure>

<p>这是因为Rust会在每个模块开始之前插入:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> std::prelude::v1::*;</div></pre></td></tr></table></figure>

<p>它重新输出了很多的符号，比如<code>Vec</code>、<code>String</code>、<code>Option</code>和<code>Result</code>。</p>
<p>结构体使用<code>struct</code>声明:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Vec2 {</div><div class="line">    x: <span class="keyword">f64</span>, <span class="comment">// 64-bit floating point, aka "double precision"</span></div><div class="line">    y: <span class="keyword">f64</span>,</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可以使用结构体文本初始化它们:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> v1 = Vec2 { x: <span class="number">1.0</span>, y: <span class="number">3.0</span> };</div><div class="line"><span class="keyword">let</span> v2 = Vec2 { y: <span class="number">2.0</span>, x: <span class="number">4.0</span> };</div><div class="line"><span class="comment">// the order does not matter, only the names do</span></div></pre></td></tr></table></figure>

<p>有一个简洁的方式使用另外一个结构体初始化余下的字段:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> v3 = Vec2 {</div><div class="line">    x: <span class="number">14.0</span>,</div><div class="line">    ..v2</div><div class="line">};</div></pre></td></tr></table></figure>

<p>这被称作<code>struct update syntax</code>，只能发生在最后的位置，后面没有逗号。</p>
<p>注意&quot;剩余的字段&quot;可以是结构体的所有字段:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> v4 = Vec2 { ..v3 };</div></pre></td></tr></table></figure>

<p>结构体，也像tuple类型一样，可以解构。</p>
<p>下面是一个合法的<code>let</code>模式:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> (left, right) = slice.split_at(middle);</div></pre></td></tr></table></figure>

<p>又比如下面的代码:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> v = Vec2 { x: <span class="number">3.0</span>, y: <span class="number">6.0</span> };</div><div class="line"><span class="keyword">let</span> Vec2 { x, y } = v;</div><div class="line"><span class="comment">// `x` is now 3.0, `y` is now `6.0`</span></div></pre></td></tr></table></figure>

<p>抑或下面的代码:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> Vec2 { x, .. } = v;</div><div class="line"><span class="comment">// this throws away `v.y`</span></div></pre></td></tr></table></figure>

<p><code>let</code>模式也可以用在<code>if</code>中当条件:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Number {</div><div class="line">    odd: <span class="keyword">bool</span>,</div><div class="line">    value: <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> one = Number { odd: <span class="keyword">true</span>, value: <span class="number">1</span> };</div><div class="line">    <span class="keyword">let</span> two = Number { odd: <span class="keyword">false</span>, value: <span class="number">2</span> };</div><div class="line">    print_number(one);</div><div class="line">    print_number(two);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: Number) {</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> Number { odd: <span class="keyword">true</span>, value } = n {</div><div class="line">        println!(<span class="string">"Odd number: {}"</span>, value);</div><div class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> Number { odd: <span class="keyword">false</span>, value } = n {</div><div class="line">        println!(<span class="string">"Even number: {}"</span>, value);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// this prints:</span></div><div class="line"><span class="comment">// Odd number: 1</span></div><div class="line"><span class="comment">// Even number: 2</span></div></pre></td></tr></table></figure>

<p><code>match</code>匹配也是模式，就像<code>if let</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: Number) {</div><div class="line">    <span class="keyword">match</span> n {</div><div class="line">        Number { odd: <span class="keyword">true</span>, value } =&gt; println!(<span class="string">"Odd number: {}"</span>, value),</div><div class="line">        Number { odd: <span class="keyword">false</span>, value } =&gt; println!(<span class="string">"Even number: {}"</span>, value),</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// this prints the same as before</span></div></pre></td></tr></table></figure>

<p>注意<code>match</code>匹配必须是详尽的，至少需要一个分支与之匹配:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: Number) {</div><div class="line">    <span class="keyword">match</span> n {</div><div class="line">        Number { value: <span class="number">1</span>, .. } =&gt; println!(<span class="string">"One"</span>),</div><div class="line">        Number { value: <span class="number">2</span>, .. } =&gt; println!(<span class="string">"Two"</span>),</div><div class="line">        Number { value, .. } =&gt; println!(<span class="string">"{}"</span>, value),</div><div class="line">        <span class="comment">// if that last arm didn't exist, we would get a compile-time error</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果你觉得麻烦，可以使用下划线<code>_</code>匹配所有的模式:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: Number) {</div><div class="line">    <span class="keyword">match</span> n.value {</div><div class="line">        <span class="number">1</span> =&gt; println!(<span class="string">"One"</span>),</div><div class="line">        <span class="number">2</span> =&gt; println!(<span class="string">"Two"</span>),</div><div class="line">        <span class="number">_</span> =&gt; println!(<span class="string">"{}"</span>, n.value),</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以为你的类型声明方法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Number {</div><div class="line">    odd: <span class="keyword">bool</span>,</div><div class="line">    value: <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">impl</span> Number {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">is_strictly_positive</span></span>(<span class="keyword">self</span>) -&gt; <span class="keyword">bool</span> {</div><div class="line">        <span class="keyword">self</span>.value &gt; <span class="number">0</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可以正常使用它们:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> minus_two = Number {</div><div class="line">        odd: <span class="keyword">false</span>,</div><div class="line">        value: -<span class="number">2</span>,</div><div class="line">    };</div><div class="line">    println!(<span class="string">"positive? {}"</span>, minus_two.is_strictly_positive());</div><div class="line">    <span class="comment">// this prints "positive? false"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>默认变量绑定是不可变的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number {</div><div class="line">        odd: <span class="keyword">true</span>,</div><div class="line">        value: <span class="number">17</span>,</div><div class="line">    };</div><div class="line">    n.odd = <span class="keyword">false</span>; <span class="comment">// error: cannot assign to `n.odd`,</span></div><div class="line">                   <span class="comment">// as `n` is not declared to be mutable</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>不可变的变量不能对其变量值进行修改，但是同时也不能通过赋值更改变量:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number {</div><div class="line">        odd: <span class="keyword">true</span>,</div><div class="line">        value: <span class="number">17</span>,</div><div class="line">    };</div><div class="line">    n = Number {</div><div class="line">        odd: <span class="keyword">false</span>,</div><div class="line">        value: <span class="number">22</span>,</div><div class="line">    }; <span class="comment">// error: cannot assign twice to immutable variable `n`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>mut</code>允许变量可以更改:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> n = Number {</div><div class="line">        odd: <span class="keyword">true</span>,</div><div class="line">        value: <span class="number">17</span>,</div><div class="line">    }</div><div class="line">    n.value = <span class="number">19</span>; <span class="comment">// all good</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>trait</code>是多个类型拥有的共同的东西:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">trait</span> <span class="title">Signed</span> {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">is_strictly_negative</span></span>(<span class="keyword">self</span>) -&gt; <span class="keyword">bool</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以实现:</p>
<ul>
<li>为任意类型实现你自己定义的trait</li>
<li>为你的类型实现任意类型的trait</li>
<li>不允许为别人的类型实现别人的trait</li>
</ul>
<p>这被称之为<code>孤立规则</code>(orphan rules)。</p>
<p>下面的例子是自定义类型实现自定义trait:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span> Signed <span class="keyword">for</span> Number {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">is_strictly_negative</span></span>(<span class="keyword">self</span>) -&gt; <span class="keyword">bool</span> {</div><div class="line">        <span class="keyword">self</span>.value &lt; <span class="number">0</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">false</span>, value: -<span class="number">44</span> };</div><div class="line">    println!(<span class="string">"{}"</span>, n.is_strictly_negative()); <span class="comment">// prints "true"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>为外部类型实现自定义trait(甚至是基本类型):</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span> Signed <span class="keyword">for</span> <span class="keyword">i32</span> {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">is_strictly_negative</span></span>(<span class="keyword">self</span>) -&gt; <span class="keyword">bool</span> {</div><div class="line">        <span class="keyword">self</span> &lt; <span class="number">0</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n: <span class="keyword">i32</span> = -<span class="number">44</span>;</div><div class="line">    println!(<span class="string">"{}"</span>, n.is_strictly_negative()); <span class="comment">// prints "true"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>为自定义类型实现外部trait:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// the `Neg` trait is used to overload `-`, the</span></div><div class="line"><span class="comment">// unary minus operator.</span></div><div class="line"><span class="keyword">impl</span> std::ops::Neg <span class="keyword">for</span> Number {</div><div class="line">    <span class="keyword">type</span> <span class="title">Output</span> = Number;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">neg</span></span>(<span class="keyword">self</span>) -&gt; Number {</div><div class="line">        Number {</div><div class="line">            value: -<span class="keyword">self</span>.value,</div><div class="line">            odd: <span class="keyword">self</span>.odd,</div><div class="line">        }        </div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">987</span> };</div><div class="line">    <span class="keyword">let</span> m = -n; <span class="comment">// this is only possible because we implemented `Neg`</span></div><div class="line">    println!(<span class="string">"{}"</span>, m.value); <span class="comment">// prints "-987"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>impl</code>总是用来为类型实现方法的，所以在这个块中，<code>Self</code>意味着这个类型:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span> std::ops::Neg <span class="keyword">for</span> Number {</div><div class="line">    <span class="keyword">type</span> <span class="title">Output</span> = Self;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">neg</span></span>(<span class="keyword">self</span>) -&gt; Self {</div><div class="line">        Self {</div><div class="line">            value: -<span class="keyword">self</span>.value,</div><div class="line">            odd: <span class="keyword">self</span>.odd,</div><div class="line">        }        </div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>有些trait只是一个标记(<code>marker</code>)，它并不是指示类型要实现什么方法，而是说这种类型可以用作做特定的事情。<br>例如<code>i32</code>实现<code>Copy</code> trait(简单地讲，<code>i32</code>是可复制的)，所以下面的代码工作正常:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> a: <span class="keyword">i32</span> = <span class="number">15</span>;</div><div class="line">    <span class="keyword">let</span> b = a; <span class="comment">// `a` is copied</span></div><div class="line">    <span class="keyword">let</span> c = a; <span class="comment">// `a` is copied again</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面的代码也正常:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_i32</span></span>(x: <span class="keyword">i32</span>) {</div><div class="line">    println!(<span class="string">"x = {}"</span>, x);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> a: <span class="keyword">i32</span> = <span class="number">15</span>;</div><div class="line">    print_i32(a); <span class="comment">// `a` is copied</span></div><div class="line">    print_i32(a); <span class="comment">// `a` is copied again</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是<code>Number</code>类型没有实现<code>Copy</code>,所以下面的代码不工作:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    <span class="keyword">let</span> m = n; <span class="comment">// `n` is moved into `m`</span></div><div class="line">    <span class="keyword">let</span> o = n; <span class="comment">// error: use of moved value: `n`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面的代码也不行:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: Number) {</div><div class="line">    println!(<span class="string">"{} number {}"</span>, <span class="keyword">if</span> n.odd { <span class="string">"odd"</span> } <span class="keyword">else</span> { <span class="string">"even"</span> }, n.value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    print_number(n); <span class="comment">// `n` is moved</span></div><div class="line">    print_number(n); <span class="comment">// error: use of moved value: `n`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是如果<code>print_number</code>使用一个不可变的引用就可以:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: &Number) {</div><div class="line">    println!(<span class="string">"{} number {}"</span>, <span class="keyword">if</span> n.odd { <span class="string">"odd"</span> } <span class="keyword">else</span> { <span class="string">"even"</span> }, n.value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    print_number(&n); <span class="comment">// `n` is borrowed for the time of the call</span></div><div class="line">    print_number(&n); <span class="comment">// `n` is borrowed again</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果变量被声明为可变的，则函数参数使用可变引用也可以工作:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">invert</span></span>(n: &<span class="keyword">mut</span> Number) {</div><div class="line">    n.value = -n.value;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_number</span></span>(n: &Number) {</div><div class="line">    println!(<span class="string">"{} number {}"</span>, <span class="keyword">if</span> n.odd { <span class="string">"odd"</span> } <span class="keyword">else</span> { <span class="string">"even"</span> }, n.value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// this time, `n` is mutable</span></div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    print_number(&n);</div><div class="line">    invert(&<span class="keyword">mut</span> n); <span class="comment">// `n is borrowed mutably - everything is explicit</span></div><div class="line">    print_number(&n);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Trait方法中的<code>self</code>参数可以使用引用，也可以使用不可变引用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span> std::clone::Clone <span class="keyword">for</span> Number {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">clone</span></span>(&<span class="keyword">self</span>) -&gt; Self {</div><div class="line">        Self { ..*<span class="keyword">self</span> }</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>当调用trait的方法时，<code>receiver</code>隐式地被借用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> m = n.clone();</div><div class="line">    m.value += <span class="number">100</span>;</div><div class="line">    </div><div class="line">    print_number(&n);</div><div class="line">    print_number(&m);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>前面讲到过，它和下面的代码一样:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> m = n.clone();</div><div class="line"></div><div class="line"><span class="keyword">let</span> m = std::clone::Clone::clone(&n);</div></pre></td></tr></table></figure>

<p>像<code>Copy</code>这样的Marker trait是没有方法的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// note: `Copy` requires that `Clone` is implemented too</span></div><div class="line"><span class="keyword">impl</span> std::clone::Clone <span class="keyword">for</span> Number {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">clone</span></span>(&<span class="keyword">self</span>) -&gt; Self {</div><div class="line">        Self { ..*<span class="keyword">self</span> }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">impl</span> std::marker::Copy <span class="keyword">for</span> Number {}</div></pre></td></tr></table></figure>

<p>现在<code>Clone</code>仍然可以使用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    <span class="keyword">let</span> m = n.clone();</div><div class="line">    <span class="keyword">let</span> o = n.clone();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是<code>Number</code>值不会被<code>move</code>了:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { odd: <span class="keyword">true</span>, value: <span class="number">51</span> };</div><div class="line">    <span class="keyword">let</span> m = n; <span class="comment">// `m` is a copy of `n`</span></div><div class="line">    <span class="keyword">let</span> o = n; <span class="comment">// same. `n` is neither moved nor borrowed.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>一些trait太通用了，我们可以通过<code>derive</code>属性自动实现它们:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[derive(Clone, Copy)]</span></div><div class="line"><span class="keyword">struct</span> Number {</div><div class="line">    odd: <span class="keyword">bool</span>,</div><div class="line">    value: <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// this expands to `impl Clone for Number` and `impl Copy for Number` blocks.</span></div></pre></td></tr></table></figure>

<p>函数可以是泛型的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;T&gt;(arg: T) {</div><div class="line">    <span class="comment">// do something with `arg`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>它们可以有多个类型参数，类型参数用在函数声明和函数体中，用来替代具体的类型:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;L, R&gt;(left: L, right: R) {</div><div class="line">    <span class="comment">// do something with `left` and `right`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>类型参数通常有约束，所以你可以用它做一些额外的事情。</p>
<p>最简单的约束就是trait名称:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>&lt;T: Display&gt;(value: T) {</div><div class="line">    println!(<span class="string">"value = {}"</span>, value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>&lt;T: Debug&gt;(value: T) {</div><div class="line">    println!(<span class="string">"value = {:?}"</span>, value);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>类型约束还可以使用更长的语法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>&lt;T&gt;(value: T)</div><div class="line">where</div><div class="line">    T: Display,</div><div class="line">{</div><div class="line">    println!(<span class="string">"value = {}"</span>, value);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>约束还可以更复杂，比如要求类型要实现多个trait:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> std::fmt::Debug;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">compare</span></span>&lt;T&gt;(left: T, right: T)</div><div class="line">where</div><div class="line">    T: Debug + PartialEq,</div><div class="line">{</div><div class="line">    println!(<span class="string">"{:?} {} {:?}"</span>, left, <span class="keyword">if</span> left == right { <span class="string">"=="</span> } <span class="keyword">else</span> { <span class="string">"!="</span> }, right);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    compare(<span class="string">"tea"</span>, <span class="string">"coffee"</span>);</div><div class="line">    <span class="comment">// prints: "tea" != "coffee"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>泛型函数可以被当作一个命名空间，包含无穷多个不同具体类型的函数。</p>
<p>类似<code>crate</code>、<code>module</code>和类型，泛型函数可以使用<code>::</code>导航:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">use</span> std::any::type_name;</div><div class="line">    println!(<span class="string">"{}"</span>, type_name::&lt;<span class="keyword">i32</span>&gt;()); <span class="comment">// prints "i32"</span></div><div class="line">    println!(<span class="string">"{}"</span>, type_name::&lt;(<span class="keyword">f64</span>, <span class="keyword">char</span>)&gt;()); <span class="comment">// prints "(f64, char)"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>这被亲切地称之为<a href="https://turbo.fish/" target="_blank" rel="external">turbofish syntax</a>,因为<code>::&lt;&gt;</code>看起来像条鱼。</p>
<p>结构体可以是泛型的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Pair&lt;T&gt; {</div><div class="line">    a: T,</div><div class="line">    b: T,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_type_name</span></span>&lt;T&gt;(<span class="number">_</span>val: &T) {</div><div class="line">    println!(<span class="string">"{}"</span>, std::any::type_name::&lt;T&gt;());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> p1 = Pair { a: <span class="number">3</span>, b: <span class="number">9</span> };</div><div class="line">    <span class="keyword">let</span> p2 = Pair { a: <span class="keyword">true</span>, b: <span class="keyword">false</span> };</div><div class="line">    print_type_name(&p1); <span class="comment">// prints "Pair&lt;i32&gt;"</span></div><div class="line">    print_type_name(&p2); <span class="comment">// prints "Pair&lt;bool&gt;"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>标准库中的<code>Vec</code>(分配在堆上的数组)就是泛型实现的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> v1 = Vec::new();</div><div class="line">    v1.push(<span class="number">1</span>);</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> v2 = Vec::new();</div><div class="line">    v2.push(<span class="keyword">false</span>);</div><div class="line">    print_type_name(&v1); <span class="comment">// prints "Vec&lt;i32&gt;"</span></div><div class="line">    print_type_name(&v2); <span class="comment">// prints "Vec&lt;bool&gt;"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>谈到<code>Vec</code>,有个宏(<code>macro</code>)可以通过字面方式声明<code>Vec</code>变量:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> v1 = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">    <span class="keyword">let</span> v2 = vec![<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>];</div><div class="line">    print_type_name(&v1); <span class="comment">// prints "Vec&lt;i32&gt;"</span></div><div class="line">    print_type_name(&v2); <span class="comment">// prints "Vec&lt;bool&gt;"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>类似<code>name!()</code>、<code>name![]</code>、<code>name!{}</code>都是调用宏的方式。宏会被展开成正常的代码。</p>
<p>事实上，<code>println</code>就是一个宏:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    println!(<span class="string">"{}"</span>, <span class="string">"Hello there!"</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>它的展开代码和下面的代码功能一样:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">use</span> std::io::{<span class="keyword">self</span>, Write};</div><div class="line">    io::stdout().lock().write_all(b<span class="string">"Hello there!\n"</span>).unwrap();</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>panic</code>也是一个宏，例如<code>Option</code>既可以包含某个值，也可以不包含值。如果它不包含值，调用它的<code>.unwrap()</code>会panic:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> o1: Option&lt;<span class="keyword">i32</span>&gt; = Some(<span class="number">128</span>);</div><div class="line">    o1.unwrap(); <span class="comment">// this is fine</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> o2: Option&lt;<span class="keyword">i32</span>&gt; = None;</div><div class="line">    o2.unwrap(); <span class="comment">// this panics!</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:378:21</span></div></pre></td></tr></table></figure>

<p><code>Option</code>并不是一个结构体，而是一个枚举类型(<code>enum</code>)，它包含两个值:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> <span class="title">Option</span>&lt;T&gt; {</div><div class="line">    None,</div><div class="line">    Some(T),</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">impl</span>&lt;T&gt; Option&lt;T&gt; {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">unwrap</span></span>(<span class="keyword">self</span>) -&gt; T {</div><div class="line">        <span class="comment">// enums variants can be used in patterns:</span></div><div class="line">        <span class="keyword">match</span> <span class="keyword">self</span> {</div><div class="line">            Self::Some(t) =&gt; t,</div><div class="line">            Self::None =&gt; panic!(<span class="string">".unwrap() called on a None option"</span>),</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">use</span> self::Option::{None, Some};</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> o1: Option&lt;<span class="keyword">i32</span>&gt; = Some(<span class="number">128</span>);</div><div class="line">    o1.unwrap(); <span class="comment">// this is fine</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> o2: Option&lt;<span class="keyword">i32</span>&gt; = None;</div><div class="line">    o2.unwrap(); <span class="comment">// this panics!</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: thread 'main' panicked at '.unwrap() called on a None option', src/main.rs:11:27</span></div></pre></td></tr></table></figure>

<p><code>Result</code>也是一个枚举类型。它既可以包含一个正常的，也可以包含一个error:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> <span class="title">Result</span>&lt;T, E&gt; {</div><div class="line">    Ok(T),</div><div class="line">    Err(E),</div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果包含error,调用它的<code>.unwrap()</code>也会panic。</p>
<p>变量绑定有<code>声明周期</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// `x` doesn't exist yet</span></div><div class="line">    {</div><div class="line">        <span class="keyword">let</span> x = <span class="number">42</span>; <span class="comment">// `x` starts existing</span></div><div class="line">        println!(<span class="string">"x = {}"</span>, x);</div><div class="line">        <span class="comment">// `x` stops existing</span></div><div class="line">    }</div><div class="line">    <span class="comment">// `x` no longer exists</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>类似地，引用也有声明周期:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// `x` doesn't exist yet</span></div><div class="line">    {</div><div class="line">        <span class="keyword">let</span> x = <span class="number">42</span>; <span class="comment">// `x` starts existing</span></div><div class="line">        <span class="keyword">let</span> x_ref = &x; <span class="comment">// `x_ref` starts existing - it borrows `x`</span></div><div class="line">        println!(<span class="string">"x_ref = {}"</span>, x_ref);</div><div class="line">        <span class="comment">// `x_ref` stops existing</span></div><div class="line">        <span class="comment">// `x` stops existing</span></div><div class="line">    }</div><div class="line">    <span class="comment">// `x` no longer exists</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>引用的声明周期不能超过它借用的变量的声明周期:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x_ref = {</div><div class="line">        <span class="keyword">let</span> x = <span class="number">42</span>;</div><div class="line">        &x</div><div class="line">    };</div><div class="line">    println!(<span class="string">"x_ref = {}"</span>, x_ref);</div><div class="line">    <span class="comment">// error: `x` does not live long enough</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>一个变量可以不可变地借用多次:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x = <span class="number">42</span>;</div><div class="line">    <span class="keyword">let</span> x_ref1 = &x;</div><div class="line">    <span class="keyword">let</span> x_ref2 = &x;</div><div class="line">    <span class="keyword">let</span> x_ref3 = &x;</div><div class="line">    println!(<span class="string">"{} {} {}"</span>, x_ref1, x_ref2, x_ref3);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>在借用的时候，变量不能被修改:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> x = <span class="number">42</span>;</div><div class="line">    <span class="keyword">let</span> x_ref = &x;</div><div class="line">    x = <span class="number">13</span>;</div><div class="line">    println!(<span class="string">"x_ref = {}"</span>, x_ref);</div><div class="line">    <span class="comment">// error: cannot assign to `x` because it is borrowed</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>当不可变地借用时，不能同时可变地的借用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> x = <span class="number">42</span>;</div><div class="line">    <span class="keyword">let</span> x_ref1 = &x;</div><div class="line">    <span class="keyword">let</span> x_ref2 = &<span class="keyword">mut</span> x;</div><div class="line">    <span class="comment">// error: cannot borrow `x` as mutable because it is also borrowed as immutable</span></div><div class="line">    println!(<span class="string">"x_ref1 = {}"</span>, x_ref1);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>函数参数中的引用也有生命周期:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>(x: &<span class="keyword">i32</span>) {</div><div class="line">    <span class="comment">// `x` is borrowed (from the outside) for the</span></div><div class="line">    <span class="comment">// entire time this function is called.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>函数中的参数被调用时可以同时使用多个的生命周期:</p>
<ul>
<li>所有使用这些引用的函数都是泛型的</li>
<li>声明周期也是泛型参数</li>
</ul>
<p>生命周期的名称以<code>&#39;</code>开始:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// elided (non-named) lifetimes:</span></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>(x: &<span class="keyword">i32</span>) {}</div><div class="line"></div><div class="line"><span class="comment">// named lifetimes:</span></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print</span></span>&lt;'a&gt;(x: &'a <span class="keyword">i32</span>) {}</div></pre></td></tr></table></figure>

<p>返回引用的声明周期依赖参数的声明周期:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Number {</div><div class="line">    value: <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">number_value</span></span>&lt;'a&gt;(num: &'a Number) -&gt; &'a <span class="keyword">i32</span> {</div><div class="line">    &num.value</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> n = Number { value: <span class="number">47</span> };</div><div class="line">    <span class="keyword">let</span> v = number_value(&n);</div><div class="line">    <span class="comment">// `v` borrows `n` (immutably), thus: `v` cannot outlive `n`.</span></div><div class="line">    <span class="comment">// While `v` exists, `n` cannot be mutably borrowed, mutated, moved, etc.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>当只有一个生命周期时，它并需要被命名，所有对象都有同样的声明周期，所以下面两个函数是等价的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">number_value</span></span>&lt;'a&gt;(num: &'a Number) -&gt; &'a <span class="keyword">i32</span> {</div><div class="line">    &num.value</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">number_value</span></span>(num: &Number) -&gt; &<span class="keyword">i32</span> {</div><div class="line">    &num.value</div><div class="line">}</div></pre></td></tr></table></figure>

<p>结构体也可以通过生命周期声明为泛型，这允许它们持有引用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> NumRef&lt;'a&gt; {</div><div class="line">    x: &'a <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x: <span class="keyword">i32</span> = <span class="number">99</span>;</div><div class="line">    <span class="keyword">let</span> x_ref = NumRef { x: &x };</div><div class="line">    <span class="comment">// `x_ref` cannot outlive `x`, etc.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>同样的代码，增加一个函数:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> NumRef&lt;'a&gt; {</div><div class="line">    x: &'a <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">as_num_ref</span></span>&lt;'a&gt;(x: &'a <span class="keyword">i32</span>) -&gt; NumRef&lt;'a&gt; {</div><div class="line">    NumRef { x: &x }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x: <span class="keyword">i32</span> = <span class="number">99</span>;</div><div class="line">    <span class="keyword">let</span> x_ref = as_num_ref(&x);</div><div class="line">    <span class="comment">// `x_ref` cannot outlive `x`, etc.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>同样的代码，使用省略的(<code>elided</code>)的生命周期:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> NumRef&lt;'a&gt; {</div><div class="line">    x: &'a <span class="keyword">i32</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">as_num_ref</span></span>(x: &<span class="keyword">i32</span>) -&gt; NumRef&lt;'_&gt; {</div><div class="line">    NumRef { x: &x }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x: <span class="keyword">i32</span> = <span class="number">99</span>;</div><div class="line">    <span class="keyword">let</span> x_ref = as_num_ref(&x);</div><div class="line">    <span class="comment">// `x_ref` cannot outlive `x`, etc.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>impl</code>块也可以使用声明周期实现泛型:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span>&lt;'a&gt; NumRef&lt;'a&gt; {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">as_i32_ref</span></span>(&'a <span class="keyword">self</span>) -&gt; &'a <span class="keyword">i32</span> {</div><div class="line">        <span class="keyword">self</span>.x</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x: <span class="keyword">i32</span> = <span class="number">99</span>;</div><div class="line">    <span class="keyword">let</span> x_num_ref = NumRef { x: &x };</div><div class="line">    <span class="keyword">let</span> x_i32_ref = x_num_ref.as_i32_ref();</div><div class="line">    <span class="comment">// neither ref cannot outlive `x`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是你同样可以使用省略的方式:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span>&lt;'a&gt; NumRef&lt;'a&gt; {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">as_i32_ref</span></span>(&<span class="keyword">self</span>) -&gt; &<span class="keyword">i32</span> {</div><div class="line">        <span class="keyword">self</span>.x</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果你不需要使用声明周期的名字，你甚至可以省略更多:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">impl</span> NumRef&lt;'_&gt; {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">as_i32_ref</span></span>(&<span class="keyword">self</span>) -&gt; &<span class="keyword">i32</span> {</div><div class="line">        <span class="keyword">self</span>.x</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>有一个特殊的声明周期，叫做<code>&#39;static</code>，它的生命周期在整个程序运行时。</p>
<p>字符串字面值就是<code>&#39;static</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Person {</div><div class="line">    name: &'static <span class="keyword">str</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> p = Person {</div><div class="line">        name: <span class="string">"fasterthanlime"</span>,</div><div class="line">    };</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是<code>owned string</code>声明周期就不是<code>&#39;static</code>的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Person {</div><div class="line">    name: &'static <span class="keyword">str</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> name = format!(<span class="string">"fasterthan{}"</span>, <span class="string">"lime"</span>);</div><div class="line">    <span class="keyword">let</span> p = Person { name: &name };</div><div class="line">    <span class="comment">// error: `name` does not live long enough</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面的例子中<code>name</code>并不是<code>&amp;&#39;static str</code>类型，而是<code>Stirng</code>类型。它是动态分配的，可以被释放。它的生命周期小于整个程序，尽管它是在<code>main</code>函数中。</p>
<p>为了在<code>Person</code>中存储一个非<code>&#39;static</code>的字符串，你需要：</p>
<p><strong>A)</strong> 通过声明周期声明泛型</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Person&lt;'a&gt; {</div><div class="line">    name: &'a <span class="keyword">str</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> name = format!(<span class="string">"fasterthan{}"</span>, <span class="string">"lime"</span>);</div><div class="line">    <span class="keyword">let</span> p = Person { name: &name };</div><div class="line">    <span class="comment">// `p` cannot outlive `name`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>或者</p>
<p><strong>B)</strong> 获得这个字符串的所有权</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Person {</div><div class="line">    name: String,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> name = format!(<span class="string">"fasterthan{}"</span>, <span class="string">"lime"</span>);</div><div class="line">    <span class="keyword">let</span> p = Person { name: name };</div><div class="line">    <span class="comment">// `name` was moved into `p`, their lifetimes are no longer tied.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>在一个结构体的字面值中，如果字段名和变量相同时:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p = Person { name: name };</div></pre></td></tr></table></figure>

<p>可以简写为:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p = Person { name };</div></pre></td></tr></table></figure>

<p>Rust中很多类型都有<code>owned</code>和非<code>owned</code>变种:</p>
<ul>
<li>字符串： <code>String</code>是owned, <code>&amp;str</code>是引用</li>
<li>路径：<code>PathBuf</code>是owned, <code>&amp;Path</code>是引用</li>
<li>集合: <code>Vec&lt;T&gt;</code>是owned, <code>&amp;[T]</code>是引用</li>
</ul>
<p>Rust有slice - 它们是对多个连续元素的引用。<br>你可以借用vector的slice，例如:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> v = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line">    <span class="keyword">let</span> v2 = &v[<span class="number">2</span>..<span class="number">4</span>];</div><div class="line">    println!(<span class="string">"v2 = {:?}"</span>, v2);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output:</span></div><div class="line"><span class="comment">// v2 = [3, 4]</span></div></pre></td></tr></table></figure>

<p>上面并没有什么魔法。索引操作符(<code>foo[index]</code>)被<code>Index</code>和<code>IndexMut</code> trait重载。<br><code>..</code>是range表示方法。 Range是标准库定义的一组结构体。<br>前后的索引值可以省略，默认右边的值是不包含的， 如果要包含右边的值，使用<code>=</code>，:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// 0 or greater</span></div><div class="line">    println!(<span class="string">"{:?}"</span>, (<span class="number">0</span>..).contains(&<span class="number">100</span>)); <span class="comment">// true</span></div><div class="line">    <span class="comment">// strictly less than 20</span></div><div class="line">    println!(<span class="string">"{:?}"</span>, (..<span class="number">20</span>).contains(&<span class="number">20</span>)); <span class="comment">// false</span></div><div class="line">    <span class="comment">// 20 or less than 20</span></div><div class="line">    println!(<span class="string">"{:?}"</span>, (..=<span class="number">20</span>).contains(&<span class="number">20</span>)); <span class="comment">// true</span></div><div class="line">    <span class="comment">// only 3, 4, 5</span></div><div class="line">    println!(<span class="string">"{:?}"</span>, (<span class="number">3</span>..<span class="number">6</span>).contains(&<span class="number">4</span>)); <span class="comment">// true</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>借用规则同样应用于slice:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">tail</span></span>(s: &[<span class="keyword">u8</span>]) -&gt; &[<span class="keyword">u8</span>] {</div><div class="line">  &s[<span class="number">1</span>..] </div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> x = &[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line">    <span class="keyword">let</span> y = tail(x);</div><div class="line">    println!(<span class="string">"y = {:?}"</span>, y);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>与下面的代码相同:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">tail</span></span>&lt;'a&gt;(s: &'a [<span class="keyword">u8</span>]) -&gt; &'a [<span class="keyword">u8</span>] {</div><div class="line">  &s[<span class="number">1</span>..] </div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面的代码是合法的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> y = {</div><div class="line">        <span class="keyword">let</span> x = &[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line">        tail(x)</div><div class="line">    };</div><div class="line">    println!(<span class="string">"y = {:?}"</span>, y);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>只不过是因为<code>[1, 2, 3, 4, 5]</code>是<code>&#39;static</code>。下面的代码就不合法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> y = {</div><div class="line">        <span class="keyword">let</span> v = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line">        tail(&v)</div><div class="line">        <span class="comment">// error: `v` does not live long enough</span></div><div class="line">    };</div><div class="line">    println!(<span class="string">"y = {:?}"</span>, y);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这是因为<code>vector</code>分配在堆上，它有非<code>&#39;static</code>的声明周期。</p>
<p><code>&amp;str</code>实际上是slice:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">file_ext</span></span>(name: &<span class="keyword">str</span>) -&gt; Option&lt;&<span class="keyword">str</span>&gt; {</div><div class="line">    <span class="comment">// this does not create a new string - it returns</span></div><div class="line">    <span class="comment">// a slice of the argument.</span></div><div class="line">    name.split(<span class="string">"."</span>).last()</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> name = <span class="string">"Read me. Or don't.txt"</span>;</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> Some(ext) = file_ext(name) {</div><div class="line">        println!(<span class="string">"file extension: {}"</span>, ext);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        println!(<span class="string">"no file extension"</span>);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>借用规则同样适用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> ext = {</div><div class="line">        <span class="keyword">let</span> name = String::from(<span class="string">"Read me. Or don't.txt"</span>);</div><div class="line">        file_ext(&name).unwrap_or(<span class="string">""</span>)</div><div class="line">        <span class="comment">// error: `name` does not live long enough</span></div><div class="line">    };</div><div class="line">    println!(<span class="string">"extension: {:?}"</span>, ext);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>返回失败的函数典型地返回<code>Result</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>]);</div><div class="line">    println!(<span class="string">"{:?}"</span>, s);</div><div class="line">    <span class="comment">// prints: Ok("🍉")</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">195</span>, <span class="number">40</span>]);</div><div class="line">    println!(<span class="string">"{:?}"</span>, s);</div><div class="line">    <span class="comment">// prints: Err(Utf8Error { valid_up_to: 0, error_len: Some(1) })</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果处理失败的时候想panic,你可以调用<code>.unwrap()</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>]).unwrap();</div><div class="line">    println!(<span class="string">"{:?}"</span>, s);</div><div class="line">    <span class="comment">// prints: "🍉"</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">195</span>, <span class="number">40</span>]).unwrap();</div><div class="line">    <span class="comment">// prints: thread 'main' panicked at 'called `Result::unwrap()`</span></div><div class="line">    <span class="comment">// on an `Err` value: Utf8Error { valid_up_to: 0, error_len: Some(1) }',</span></div><div class="line">    <span class="comment">// src/libcore/result.rs:1165:5</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>或者调用<code>.expect()</code> panic一个定制的信息:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">195</span>, <span class="number">40</span>]).expect(<span class="string">"valid utf-8"</span>);</div><div class="line">    <span class="comment">// prints: thread 'main' panicked at 'valid utf-8: Utf8Error</span></div><div class="line">    <span class="comment">// { valid_up_to: 0, error_len: Some(1) }', src/libcore/result.rs:1165:5</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>抑或使用<code>match</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">match</span> std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>]) {</div><div class="line">        Ok(s) =&gt; println!(<span class="string">"{}"</span>, s),</div><div class="line">        Err(e) =&gt; panic!(e),</div><div class="line">    }</div><div class="line">    <span class="comment">// prints 🍉</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>甚至使用<code>if let</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> Ok(s) = std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>]) {</div><div class="line">        println!(<span class="string">"{}"</span>, s);</div><div class="line">    }</div><div class="line">    <span class="comment">// prints 🍉</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>再不济给上层抛出错误:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; Result&lt;(), std::str::Utf8Error&gt; {</div><div class="line">    <span class="keyword">match</span> std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>]) {</div><div class="line">        Ok(s) =&gt; println!(<span class="string">"{}"</span>, s),</div><div class="line">        Err(e) =&gt; <span class="keyword">return</span> Err(e),</div><div class="line">    }</div><div class="line">    Ok(())</div><div class="line">}</div></pre></td></tr></table></figure>

<p>常用的简洁方式是使用<code>?</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; Result&lt;(), std::str::Utf8Error&gt; {</div><div class="line">    <span class="keyword">let</span> s = std::str::from_utf8(&[<span class="number">240</span>, <span class="number">159</span>, <span class="number">141</span>, <span class="number">137</span>])?;</div><div class="line">    println!(<span class="string">"{}"</span>, s);</div><div class="line">    Ok(())</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>*</code>符号常用来解引用，但是你不需要专门访问字段或者调用方法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Point {</div><div class="line">    x: <span class="keyword">f64</span>,</div><div class="line">    y: <span class="keyword">f64</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> p = Point { x: <span class="number">1.0</span>, y: <span class="number">3.0</span> };</div><div class="line">    <span class="keyword">let</span> p_ref = &p;</div><div class="line">    println!(<span class="string">"({}, {})"</span>, p_ref.x, p_ref.y);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// prints `(1, 3)`</span></div></pre></td></tr></table></figure>

<p>如果类型是可复制的(实现<code>Copy</code>),那么你可以:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Point {</div><div class="line">    x: <span class="keyword">f64</span>,</div><div class="line">    y: <span class="keyword">f64</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">negate</span></span>(p: Point) -&gt; Point {</div><div class="line">    Point {</div><div class="line">        x: -p.x,</div><div class="line">        y: -p.y,</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> p = Point { x: <span class="number">1.0</span>, y: <span class="number">3.0</span> };</div><div class="line">    <span class="keyword">let</span> p_ref = &p;</div><div class="line">    negate(*p_ref);</div><div class="line">    <span class="comment">// error: cannot move out of `*p_ref` which is behind a shared reference</span></div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// now `Point` is `Copy`</span></div><div class="line"><span class="preprocessor">#[derive(Clone, Copy)]</span></div><div class="line"><span class="keyword">struct</span> Point {</div><div class="line">    x: <span class="keyword">f64</span>,</div><div class="line">    y: <span class="keyword">f64</span>,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">negate</span></span>(p: Point) -&gt; Point {</div><div class="line">    Point {</div><div class="line">        x: -p.x,</div><div class="line">        y: -p.y,</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> p = Point { x: <span class="number">1.0</span>, y: <span class="number">3.0</span> };</div><div class="line">    <span class="keyword">let</span> p_ref = &p;</div><div class="line">    negate(*p_ref); <span class="comment">// ...and now this works</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>闭包(<code>Closure</code>)是实现了<code>Fn</code>、<code>FnMut</code>、<code>FnOnce</code>类型的函数。并且带有捕获的上下文。</p>
<p>参数是以逗号分隔的名称列表，在<code>|</code>之中。它们不需要大括号，除非你有多行语句:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">for_each_planet</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: Fn(&'static <span class="keyword">str</span>)</div><div class="line">{</div><div class="line">    f(<span class="string">"Earth"</span>);</div><div class="line">    f(<span class="string">"Mars"</span>);</div><div class="line">    f(<span class="string">"Jupiter"</span>);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    for_each_planet(|planet| println!(<span class="string">"Hello, {}"</span>, planet));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// prints:</span></div><div class="line"><span class="comment">// Hello, Earth</span></div><div class="line"><span class="comment">// Hello, Mars</span></div><div class="line"><span class="comment">// Hello, Jupiter</span></div></pre></td></tr></table></figure>

<p>借用规则同样适用:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">for_each_planet</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: Fn(&'static <span class="keyword">str</span>)</div><div class="line">{</div><div class="line">    f(<span class="string">"Earth"</span>);</div><div class="line">    f(<span class="string">"Mars"</span>);</div><div class="line">    f(<span class="string">"Jupiter"</span>);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> greeting = String::from(<span class="string">"Good to see you"</span>);</div><div class="line">    for_each_planet(|planet| println!(<span class="string">"{}, {}"</span>, greeting, planet));</div><div class="line">    <span class="comment">// our closure borrows `greeting`, so it cannot outlive it</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>比如下面的代码就不工作:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">for_each_planet</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: Fn(&'static <span class="keyword">str</span>) + 'static <span class="comment">// `F` must now have "'static" lifetime</span></div><div class="line">{</div><div class="line">    f(<span class="string">"Earth"</span>);</div><div class="line">    f(<span class="string">"Mars"</span>);</div><div class="line">    f(<span class="string">"Jupiter"</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> greeting = String::from(<span class="string">"Good to see you"</span>);</div><div class="line">    for_each_planet(|planet| println!(<span class="string">"{}, {}"</span>, greeting, planet));</div><div class="line">    <span class="comment">// error: closure may outlive the current function, but it borrows</span></div><div class="line">    <span class="comment">// `greeting`, which is owned by the current function</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是下面的代码就可以:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> greeting = String::from(<span class="string">"You're doing great"</span>);</div><div class="line">    for_each_planet(move |planet| println!(<span class="string">"{}, {}"</span>, greeting, planet));</div><div class="line">    <span class="comment">// `greeting` is no longer borrowed, it is *moved* into</span></div><div class="line">    <span class="comment">// the closure.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>FnMut</code>需要可变地借用去调用，所以它同时只能调用一次。</p>
<p>下面的代码合法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: Fn(<span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span></div><div class="line">{</div><div class="line">    println!(<span class="string">"{}"</span>, f(f(<span class="number">2</span>))); </div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    foobar(|x| x * <span class="number">2</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: 8</span></div></pre></td></tr></table></figure>

<p>下面的代码不合法:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(<span class="keyword">mut</span> f: F)</div><div class="line">    where F: FnMut(<span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span></div><div class="line">{</div><div class="line">    println!(<span class="string">"{}"</span>, f(f(<span class="number">2</span>))); </div><div class="line">    <span class="comment">// error: cannot borrow `f` as mutable more than once at a time</span></div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    foobar(|x| x * <span class="number">2</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>然后下民的代码有合法了:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(<span class="keyword">mut</span> f: F)</div><div class="line">    where F: FnMut(<span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span></div><div class="line">{</div><div class="line">    <span class="keyword">let</span> tmp = f(<span class="number">2</span>);</div><div class="line">    println!(<span class="string">"{}"</span>, f(tmp)); </div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    foobar(|x| x * <span class="number">2</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: 8</span></div></pre></td></tr></table></figure>

<p>之所以有<code>FnMut</code>类似，是因为有些闭包会可变地借用本地变量:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(<span class="keyword">mut</span> f: F)</div><div class="line">    where F: FnMut(<span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span></div><div class="line">{</div><div class="line">    <span class="keyword">let</span> tmp = f(<span class="number">2</span>);</div><div class="line">    println!(<span class="string">"{}"</span>, f(tmp)); </div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> acc = <span class="number">2</span>;</div><div class="line">    foobar(|x| {</div><div class="line">        acc += <span class="number">1</span>;</div><div class="line">        x * acc</div><div class="line">    });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: 24</span></div></pre></td></tr></table></figure>

<p>这些闭包不能传给期望<code>Fn</code>类型的参数:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: Fn(<span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span></div><div class="line">{</div><div class="line">    println!(<span class="string">"{}"</span>, f(f(<span class="number">2</span>))); </div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> acc = <span class="number">2</span>;</div><div class="line">    foobar(|x| {</div><div class="line">        acc += <span class="number">1</span>;</div><div class="line">        <span class="comment">// error: cannot assign to `acc`, as it is a</span></div><div class="line">        <span class="comment">// captured variable in a `Fn` closure.</span></div><div class="line">        <span class="comment">// the compiler suggests "changing foobar</span></div><div class="line">        <span class="comment">// to accept closures that implement `FnMut`"</span></div><div class="line">        x * acc</div><div class="line">    });</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>FnOnce</code>闭包只会被调用一次。因为一些闭包会把move进来的变量在返回值中move out:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: FnOnce() -&gt; String</div><div class="line">{</div><div class="line">    println!(<span class="string">"{}"</span>, f()); </div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = String::from(<span class="string">"alright"</span>);</div><div class="line">    foobar(move || s);</div><div class="line">    <span class="comment">// `s` was moved into our closure, and our</span></div><div class="line">    <span class="comment">// closures moves it to the caller by returning</span></div><div class="line">    <span class="comment">// it. Remember that `String` is not `Copy`.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>这是自然限制的，因为<code>FnOnce</code>闭包在调用的时候需要被move:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(f: F)</div><div class="line">    where F: FnOnce() -&gt; String</div><div class="line">{</div><div class="line">    println!(<span class="string">"{}"</span>, f()); </div><div class="line">    println!(<span class="string">"{}"</span>, f()); </div><div class="line">    <span class="comment">// error: use of moved value: `f`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>而且你确保使用<code>move</code>调用闭包，它依然是非法的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = String::from(<span class="string">"alright"</span>);</div><div class="line">    foobar(move || s);</div><div class="line">    foobar(move || s);</div><div class="line">    <span class="comment">// use of moved value: `s`</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是下面的代码就是合法的:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> s = String::from(<span class="string">"alright"</span>);</div><div class="line">    foobar(|| s.clone());</div><div class="line">    foobar(|| s.clone());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面是有两个参数的闭包:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foobar</span></span>&lt;F&gt;(x: <span class="keyword">i32</span>, y: <span class="keyword">i32</span>, is_greater: F)</div><div class="line">    where F: Fn(<span class="keyword">i32</span>, <span class="keyword">i32</span>) -&gt; <span class="keyword">bool</span></div><div class="line">{</div><div class="line">    <span class="keyword">let</span> (greater, smaller) = <span class="keyword">if</span> is_greater(x, y) {</div><div class="line">        (x, y)</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        (y, x)</div><div class="line">    };</div><div class="line">    println!(<span class="string">"{} is greater than {}"</span>, greater, smaller);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    foobar(<span class="number">32</span>, <span class="number">64</span>, |x, y| x &gt; y);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面是忽略了这两个参数的闭包:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    foobar(<span class="number">32</span>, <span class="number">64</span>, |<span class="number">_</span>, <span class="number">_</span>| panic!(<span class="string">"Comparing is futile!"</span>));</div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面是一个唱“滴答”的闭包:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">countdown</span></span>&lt;F&gt;(count: usize, tick: F)</div><div class="line">    where F: Fn(usize)</div><div class="line">{</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">1</span>..=count).rev() {</div><div class="line">        tick(i);</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    countdown(<span class="number">3</span>, |i| println!(<span class="string">"tick {}..."</span>, i));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output:</span></div><div class="line"><span class="comment">// tick 3...</span></div><div class="line"><span class="comment">// tick 2...</span></div><div class="line"><span class="comment">// tick 1...</span></div></pre></td></tr></table></figure>

<p>下面是一个马桶闭包:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    countdown(<span class="number">3</span>, |<span class="number">_</span>| ());</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>|_| ()</code>看起来像不像一个🚽？</p>
<p>任意的迭代的东西都可以放在<code>for in</code>循环中。</p>
<p>前面我们已经看到了range，也可以使用<code>for in</code>操作<code>Vec</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> vec![<span class="number">52</span>, <span class="number">49</span>, <span class="number">21</span>] {</div><div class="line">        println!(<span class="string">"I like the number {}"</span>, i);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>或者处理slice:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> &[<span class="number">52</span>, <span class="number">49</span>, <span class="number">21</span>] {</div><div class="line">        println!(<span class="string">"I like the number {}"</span>, i);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output:</span></div><div class="line"><span class="comment">// I like the number 52</span></div><div class="line"><span class="comment">// I like the number 49</span></div><div class="line"><span class="comment">// I like the number 21</span></div></pre></td></tr></table></figure>

<p>或者是一个实际的迭代器:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// note: `&str` also has a `.bytes()` iterator.</span></div><div class="line">    <span class="comment">// Rust's `char` type is a "Unicode scalar value"</span></div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">"rust"</span>.chars() {</div><div class="line">        println!(<span class="string">"Give me a {}"</span>, c);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output:</span></div><div class="line"><span class="comment">// Give me a r</span></div><div class="line"><span class="comment">// Give me a u</span></div><div class="line"><span class="comment">// Give me a s</span></div><div class="line"><span class="comment">// Give me a t</span></div></pre></td></tr></table></figure>

<p>即使迭代器的元素被加上了过滤、映射、展开等操作:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">"sHE'S brOKen"</span></div><div class="line">        .chars()</div><div class="line">        .filter(|c| c.is_uppercase() || !c.is_ascii_alphabetic())</div><div class="line">        .flat_map(|c| c.to_lowercase())</div><div class="line">    {</div><div class="line">        print!(<span class="string">"{}"</span>, c);</div><div class="line">    }</div><div class="line">    println!();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output: he's ok</span></div></pre></td></tr></table></figure>

<p>你可以在一个函数中返回一个闭包:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">make_tester</span></span>(answer: String) -&gt; <span class="keyword">impl</span> Fn(&<span class="keyword">str</span>) -&gt; <span class="keyword">bool</span> {</div><div class="line">    move |challenge| {</div><div class="line">        challenge == answer</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="comment">// you can use `.into()` to perform conversions</span></div><div class="line">    <span class="comment">// between various types, here `&'static str` and `String`</span></div><div class="line">    <span class="keyword">let</span> test = make_tester(<span class="string">"hunter2"</span>.into());</div><div class="line">    println!(<span class="string">"{}"</span>, test(<span class="string">"******"</span>));</div><div class="line">    println!(<span class="string">"{}"</span>, test(<span class="string">"hunter2"</span>));</div><div class="line">}</div></pre></td></tr></table></figure>

<p>甚至你可以move函数的参数的引用到闭包中返回:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">make_tester</span></span>&lt;'a&gt;(answer: &'a <span class="keyword">str</span>) -&gt; <span class="keyword">impl</span> Fn(&<span class="keyword">str</span>) -&gt; <span class="keyword">bool</span> + 'a {</div><div class="line">    move |challenge| {</div><div class="line">        challenge == answer</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</div><div class="line">    <span class="keyword">let</span> test = make_tester(<span class="string">"hunter2"</span>);</div><div class="line">    println!(<span class="string">"{}"</span>, test(<span class="string">"*******"</span>));</div><div class="line">    println!(<span class="string">"{}"</span>, test(<span class="string">"hunter2"</span>));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// output:</span></div><div class="line"><span class="comment">// false</span></div><div class="line"><span class="comment">// true</span></div></pre></td></tr></table></figure>

<p>省略生命周期名称:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">make_tester</span></span>(answer: &<span class="keyword">str</span>) -&gt; <span class="keyword">impl</span> Fn(&<span class="keyword">str</span>) -&gt; <span class="keyword">bool</span> + '_ {</div><div class="line">    move |challenge| {</div><div class="line">        challenge == answer</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>好了，半小时到了，通过本次学习，你应该能通过线上大部分的rust代码。</p>
<p>写rust代码和读rust又有很大的不同。一方面你不是在读一个问题的解决访问，而是正在解决它；另一方面Rust编译器会给你很大的帮助。</p>
<p>对于上面非法的rust代码，rustc总是会给你清楚的错误提示和富有洞察力的建议。</p>
<p>如果提示缺失，编译器组欢迎你提出来。</p>
<p>如果需要更多的Rust学习资料，你可以访问下面的资源:</p>
<ul>
<li><a href="https://doc.rust-lang.org/book/" target="_blank" rel="external">The Rust Book</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/" target="_blank" rel="external">Rust By Example</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/" target="_blank" rel="external">Read Rust</a></li>
<li><a href="https://this-week-in-rust.org/" target="_blank" rel="external">This Week In Rust</a></li>
</ul>
<p>我也会写一些关于rust的博文和tweet。</p>
<p>阅读愉快。</p>
<p>blablabla一堆感谢。</p>

      
    </div>
    <footer class="article-footer">
      

      
      <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script> -->
      <section id="comments">
        <script src="https://utteranc.es/client.js"
                repo="smallnest/gitalk"
                issue-term="title"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        <!-- <div id="gitalk-container"></div>
        <script type="text/javascript">
          var gitalkOpts = {
            id: '2020/03/05/A-half-hour-to-learn-Rust/',
            owner: 'smallnest',
            repo: 'gitalk',
            title: 'Rust半小时教程',
            body: 'https://colobu.com/2020/03/05/A-half-hour-to-learn-Rust/',
            clientID: 'bc02724130ed5b7ee275',
            clientSecret: '68cb0bae2f93a8b88b09e0eb9b08c844b06a9047',
            admin: ['smallnest'],
            distractionFreeMode: false
          };

          const gitalk = new Gitalk(gitalkOpts)
          gitalk.render('gitalk-container')
        </script> -->
        <noscript> 为正常使用评论功能请激活JavaScript</noscript>
      </section>

      

    </footer>
  </div>
  
  
<nav id="article-nav">
  
    <a href="/2020/03/15/understanding-Real-World-interface-design-in-go/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          理解Go接口的实际应用
        
      </div>
    </a>
  
  
    <a href="/2020/02/21/ID-generator/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">分布式ID生成方案</div>
    </a>
  
</nav>

  
</article></section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">微信公众号</h3>
  <div class="widget">
    <img width="100%" src="/images/widgets/gopatterns.jpg">
  </div>
</div>

<div class="widget-wrap">
  <h3 class="widget-title">极客时间专栏</h3>
  <div class="widget">
    <a href="https://time.geekbang.org/column/intro/100061801">
      <img width="100%" src="/images/widgets/geekbang.png">
    </a>
  </div>
</div>

<div class="widget-wrap">
    <h3 class="widget-title">原创图书</h3>
    <div class="widget">
      <a href="/ScalaCollectionsCookbook/">
        <img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook.jpg">
        <img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook_tw.png">
      </a>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DOTNET/">DOTNET</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">241</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rust/">Rust</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Scala/">Scala</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rust/">rust</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分享/">分享</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/">前端开发</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/区块链/">区块链</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/管理/">管理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络编程/">网络编程</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发编程/">高并发编程</a><span class="category-list-count">20</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 15.71px;">Android</a><a href="/tags/ApacheBench/" style="font-size: 11.43px;">ApacheBench</a><a href="/tags/Bower/" style="font-size: 10.00px;">Bower</a><a href="/tags/C/" style="font-size: 10.00px;">C#</a><a href="/tags/CDN/" style="font-size: 10.00px;">CDN</a><a href="/tags/CQRS/" style="font-size: 10.00px;">CQRS</a><a href="/tags/CRC/" style="font-size: 10.00px;">CRC</a><a href="/tags/CSS/" style="font-size: 11.43px;">CSS</a><a href="/tags/CompletableFuture/" style="font-size: 10.00px;">CompletableFuture</a><a href="/tags/Comsat/" style="font-size: 10.00px;">Comsat</a><a href="/tags/Curator/" style="font-size: 18.57px;">Curator</a><a href="/tags/DSL/" style="font-size: 10.00px;">DSL</a><a href="/tags/Disruptor/" style="font-size: 10.00px;">Disruptor</a><a href="/tags/Docker/" style="font-size: 11.43px;">Docker</a><a href="/tags/Ember/" style="font-size: 11.43px;">Ember</a><a href="/tags/FastJson/" style="font-size: 10.00px;">FastJson</a><a href="/tags/Fiber/" style="font-size: 10.00px;">Fiber</a><a href="/tags/GAE/" style="font-size: 10.00px;">GAE</a><a href="/tags/GC/" style="font-size: 12.86px;">GC</a><a href="/tags/Gnuplot/" style="font-size: 10.00px;">Gnuplot</a><a href="/tags/Go/" style="font-size: 14.29px;">Go</a><a href="/tags/Gradle/" style="font-size: 10.00px;">Gradle</a><a href="/tags/Grunt/" style="font-size: 10.00px;">Grunt</a><a href="/tags/Gulp/" style="font-size: 10.00px;">Gulp</a><a href="/tags/Hadoop/" style="font-size: 10.00px;">Hadoop</a><a href="/tags/Hazelcast/" style="font-size: 10.00px;">Hazelcast</a><a href="/tags/IPFS/" style="font-size: 10.00px;">IPFS</a><a href="/tags/Ignite/" style="font-size: 10.00px;">Ignite</a><a href="/tags/JVM/" style="font-size: 10.00px;">JVM</a><a href="/tags/Java/" style="font-size: 17.14px;">Java</a><a href="/tags/Kafka/" style="font-size: 20.00px;">Kafka</a><a href="/tags/Lambda/" style="font-size: 14.29px;">Lambda</a><a href="/tags/Linux/" style="font-size: 12.86px;">Linux</a><a href="/tags/LongAdder/" style="font-size: 10.00px;">LongAdder</a><a href="/tags/MathJax/" style="font-size: 10.00px;">MathJax</a><a href="/tags/Maven/" style="font-size: 11.43px;">Maven</a><a href="/tags/Memcached/" style="font-size: 10.00px;">Memcached</a><a href="/tags/Metrics/" style="font-size: 10.00px;">Metrics</a><a href="/tags/Mongo/" style="font-size: 12.86px;">Mongo</a><a href="/tags/Netty/" style="font-size: 15.71px;">Netty</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/09/27/when-and-how-to-use-classical-bpf/">何时以及如何高效的使用经典的bpf, 它能到来什么好处？</a>
          </li>
        
          <li>
            <a href="/2023/09/24/reread-the-io-Reader/">从头再读取 io.Reader: 覆水难收？</a>
          </li>
        
          <li>
            <a href="/2023/09/24/precise-rtt-for-ping/">更精准的时延：使用软件时间戳和硬件时间戳</a>
          </li>
        
          <li>
            <a href="/2023/09/13/pgo/">PGO: 为你的Go程序提效5%</a>
          </li>
        
          <li>
            <a href="/2023/09/11/tracing-a-packet-journey-using-linux-tracepoints-perf-ebpf/">使用Linux tracepoints、perf 和 eBPF 跟踪包的旅程</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
			 
            <a href="http://stackshare.io" target="_blank">技术栈</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="https://toutiao.io/" target="_blank">开发者头条</a>
			
          </li>
        
          <li>
			 
            <a href="http://weekly.manong.io/issues/" target="_blank">码农周刊</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.tuicool.com/mags" target="_blank">编程狂人周刊</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.importnew.com/" target="_blank">importnew</a>
			
          </li>
        
          <li>
			 
            <a href="http://ifeve.com/" target="_blank">并发编程网</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="http://github.com" target="_blank">github</a>
			
          </li>
        
          <li>
			 
            <a href="http://stackoverflow.com/" target="_blank">stackoverflow</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.javacodegeeks.com/" target="_blank">javacodegeeks</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.infoq.com/" target="_blank">infoq</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.dzone.com/links/index.html" target="_blank">dzone</a>
			
          </li>
        
          <li>
			 
            <a href="https://oj.leetcode.com/problems/" target="_blank">leetcode</a>
			
          </li>
        
          <li>
			 
            <a href="http://tutorials.jenkov.com" target="_blank">jenkov</a>
			
          </li>
        
          <li>
			 
            <a href="https://howtodoinjava.com" target="_blank">HowToDoInJava</a>
			
          </li>
        
          <li>
			 
            <a href="https://java-design-patterns.com/patterns/" target="_blank">java design patterns</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="https://medium.com/netflix-techblog" target="_blank">Netflix技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://www.techiedelight.com" target="_blank">Techie Delight</a>
			
          </li>
        
          <li>
			 
            <a href="https://engineering.linkedin.com/blog" target="_blank">Linkedin技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://blogs.dropbox.com/tech/" target="_blank">Dropbox技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://code.fb.com" target="_blank">Facebook技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="http://jm.taobao.org" target="_blank">淘宝中间件团队</a>
			
          </li>
        
          <li>
			 
            <a href="https://tech.meituan.com" target="_blank">美团技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="http://blogs.360.cn" target="_blank">360技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://xiaomi-info.github.io" target="_blank">小米信息部技术团队</a>
			
          </li>
        
      </ul>
    </div>
  </div>

  
      

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 smallnest<br>
	  Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    
      <a href="/" class="mobile-nav-link"><i class="fa fa-home">&nbsp;</i>首页</a>
    
  
    
      <a href="/archives" class="mobile-nav-link"><i class="fa fa-folder-o">&nbsp;</i>归档</a>
    
  
    
      <a href="https://github.com/smallnest" class="mobile-nav-link"><i class="fa fa-github">&nbsp;</i>github</a>
    
  
    
      <a class="mobile-nav-link" href="#"><i class="fa fa-bars">&nbsp;</i>网站群</a>
    
      
            <a class="mobile-nav-link" href="/goasm">&nbsp;&nbsp;<i class="fa fa-language">&nbsp;</i>Go汇编示例</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://gowebexamples.com">&nbsp;&nbsp;<i class="fa fa-external-link">&nbsp;</i>Go Web开发示例</a>
          
          
    
      
            <a class="mobile-nav-link" href="http://go-database-sql.org">&nbsp;&nbsp;<i class="fa fa-external-link">&nbsp;</i>Go 数据库开发教程</a>
          
          
    
      
            
          
          
    
      
            <a class="mobile-nav-link" href="http://rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPCX官网</a>
          
          
    
      
            <a class="mobile-nav-link" href="http://cn.doc.rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPC开发指南</a>
          
          
    
    
  
    
      <a href="/ScalaCollectionsCookbook" class="mobile-nav-link"><i class="fa fa-book">&nbsp;</i>Scala集合技术手册</a>
    
  
    
      <a href="/about" class="mobile-nav-link"><i class="fa fa-lemon-o">&nbsp;</i>关于</a>
    
  
</nav>
    
<script src="//cdn.staticfile.org/jquery/1.11.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script>


<script src="/js/script.js" type="text/javascript"></script>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>
<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.6.0-beta.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div id="totop" style="position:fixed;bottom:150px;right:10px;cursor: pointer;z-index: 2000;">
	<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="/js/totop.js" type="text/javascript"></script>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e085d87993250aab11f3e0c15f1c2785";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </div>
</body>
</html>