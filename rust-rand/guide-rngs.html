<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>支持的 RNGs - The Rust Rand Book（中文版）</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Rust Rand 库的拓展文档">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">简介</a></li><li class="chapter-item expanded "><a href="guide-start.html"><strong aria-hidden="true">1.</strong> 入门指引</a></li><li class="chapter-item expanded "><a href="crates.html"><strong aria-hidden="true">2.</strong> crates 和 features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="crates-rand.html"><strong aria-hidden="true">2.1.</strong> Rand 与协作库</a></li><li class="chapter-item expanded "><a href="crates-gen.html"><strong aria-hidden="true">2.2.</strong> 随机数生成器</a></li></ol></li><li class="chapter-item expanded "><a href="guide.html"><strong aria-hidden="true">3.</strong> 使用指南</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guide-data.html"><strong aria-hidden="true">3.1.</strong> 随机数据</a></li><li class="chapter-item expanded "><a href="guide-gen.html"><strong aria-hidden="true">3.2.</strong> 生成器的分类</a></li><li class="chapter-item expanded "><a href="guide-rngs.html" class="active"><strong aria-hidden="true">3.3.</strong> 支持的 RNGs</a></li><li class="chapter-item expanded "><a href="guide-seeding.html"><strong aria-hidden="true">3.4.</strong> 随机数种子</a></li><li class="chapter-item expanded "><a href="guide-values.html"><strong aria-hidden="true">3.5.</strong> 随机值</a></li><li class="chapter-item expanded "><a href="guide-dist.html"><strong aria-hidden="true">3.6.</strong> 概率分布</a></li><li class="chapter-item expanded "><a href="guide-seq.html"><strong aria-hidden="true">3.7.</strong> 随机序列</a></li><li class="chapter-item expanded "><a href="guide-err.html"><strong aria-hidden="true">3.8.</strong> 处理 Error</a></li></ol></li><li class="chapter-item expanded "><a href="portability.html"><strong aria-hidden="true">4.</strong> 移植性</a></li><li class="chapter-item expanded "><a href="update.html"><strong aria-hidden="true">5.</strong> 版本更新说明</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="update-0.5.html"><strong aria-hidden="true">5.1.</strong> 更新至 0.5</a></li><li class="chapter-item expanded "><a href="update-0.6.html"><strong aria-hidden="true">5.2.</strong> 更新至 0.6</a></li><li class="chapter-item expanded "><a href="update-0.7.html"><strong aria-hidden="true">5.3.</strong> 更新至 0.7</a></li><li class="chapter-item expanded "><a href="update-0.8.html"><strong aria-hidden="true">5.4.</strong> 更新至 0.8</a></li></ol></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">6.</strong> 贡献说明</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contrib-doc.html"><strong aria-hidden="true">6.1.</strong> 文档要求</a></li><li class="chapter-item expanded "><a href="contrib-scope.html"><strong aria-hidden="true">6.2.</strong> 贡献范围</a></li><li class="chapter-item expanded "><a href="contrib-test.html"><strong aria-hidden="true">6.3.</strong> 代码测试</a></li><li class="chapter-item expanded "><a href="contrib-bench.html"><strong aria-hidden="true">6.4.</strong> 基准测试</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Rand Book（中文版）</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/zjp-CN/Rust-Rand-Book-zh" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="支持的-rngs"><a class="header" href="#支持的-rngs">支持的 RNGs</a></h1>
<p>有很多种 RNGs ，它们具有各自的优缺点。
Rand 库在 <a href="https://rust-random.github.io/rand/rand/rngs/index.html"><code>rngs</code></a> 模块 里提供了一些方便的生成器。
通常你可以使用 <a href="https://rust-random.github.io/rand/rand/fn.thread_rng.html"><code>thread_rng</code></a> 函数，它会在本地线程内存中自动初始化一个 RNG ，
然后返回它的引用；它很快，质量不错，而且（据我们所知）是加密级安全的。</p>
<h1 id="介绍生成器"><a class="header" href="#介绍生成器">介绍生成器</a></h1>
<h2 id="基础的-prngs"><a class="header" href="#基础的-prngs">基础的 PRNGs</a></h2>
<p>“标准的”非加密级别的 PRNGs
的目标常常是在易用、质量、内存占用和性能之间找到良好的平衡点。
非加密级别的生成器时间上先于加密级别的生成器，
在某些方面已被加密级的淘汰，但是非加密级别的生成器有以下一些优势：
更小的状态，快速初始化、使用简单、在嵌入式 CPUs 上更小的内存占用。
然而不是所有非加密级的 PRNGs 提供这些优点，
比如 Mersenne Twister 算法虽容易预测，但有很大的状态。</p>
<p>这些算法对于 Monte Carlo 模拟是很重要的，
而且也适合像随机化算法、随机化游戏这样场景，没有预测问题。
注意，赌博游戏可能具有预测方面问题，从而推荐加密级的 PRNGs 。</p>
<p>Rand 库提供的非加密级 PRNGs 可以用下面的表格总结。
你可能需要参考 <a href="http://www.pcg-random.org/">pcg-random</a> 和 <a href="http://xoshiro.di.unimi.it/">xoshiro</a> 。</p>
<div class="table-wrapper"><table><thead><tr><th>名称</th><th>全名</th><th>性能</th><th>内存</th><th>质量</th><th>范围</th><th>特点</th></tr></thead><tbody>
<tr><td><a href="https://rust-random.github.io/rand/rand/rngs/struct.SmallRng.html"><code>SmallRng</code></a></td><td>无</td><td>7 GB/s</td><td>16 bytes</td><td>★★★☆☆</td><td>≥ <code>u32</code> * 2<sup>64</sup></td><td>无移植性</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_pcg/type.Pcg32.html"><code>Pcg32</code></a></td><td>PCG XSH RR 64/32 (LCG)</td><td>3 GB/s</td><td>16 bytes</td><td>★★★☆☆</td><td><code>u32</code> * 2<sup>64</sup></td><td>—</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_pcg/type.Pcg64.html"><code>Pcg64</code></a></td><td>PCG XSL 128/64 (LCG)</td><td>4 GB/s</td><td>32 bytes</td><td>★★★☆☆</td><td><code>u64</code> * 2<sup>128</sup></td><td>—</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_pcg/type.Pcg64Mcg.html"><code>Pcg64Mcg</code></a></td><td>PCG XSL 128/64 (MCG)</td><td>7 GB/s</td><td>16 bytes</td><td>★★★☆☆</td><td><code>u64</code> * 2<sup>126</sup></td><td>—</td></tr>
<tr><td><a href="https://docs.rs/rand_xorshift/latest/rand_xorshift/struct.XorShiftRng.html"><code>XorShiftRng</code></a></td><td>Xorshift 32/128</td><td>5 GB/s</td><td>16 bytes</td><td>★☆☆☆☆</td><td><code>u32</code> * 2<sup>128</sup> - 1</td><td>—</td></tr>
<tr><td><a href="https://docs.rs/rand_xoshiro/latest/rand_xoshiro/struct.Xoshiro256PlusPlus.html"><code>Xoshiro256PlusPlus</code></a></td><td>Xoshiro256++</td><td>7 GB/s</td><td>32 bytes</td><td>★★★☆☆</td><td><code>u64</code> * 2<sup>256</sup> - 1</td><td>jump-ahead</td></tr>
<tr><td><a href="https://docs.rs/rand_xoshiro/latest/rand_xoshiro/struct.Xoshiro256Plus.html"><code>Xoshiro256Plus</code></a></td><td>Xoshiro256+</td><td>8 GB/s</td><td>32 bytes</td><td>★★☆☆☆</td><td><code>u64</code> * 2<sup>256</sup> - 1</td><td>jump-ahead</td></tr>
<tr><td><a href="https://docs.rs/rand_xoshiro/latest/rand_xoshiro/struct.SplitMix64.html"><code>SplitMix64</code></a></td><td>splitmix64</td><td>8 GB/s</td><td>8 bytes</td><td>★☆☆☆☆</td><td><code>u64</code> * 2<sup>64</sup></td><td>—</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand/rngs/mock/struct.StepRng.html"><code>StepRng</code></a></td><td>counter</td><td>51 GB/s</td><td>16 bytes</td><td>☆☆☆☆☆</td><td><code>u64</code> * 2<sup>64</sup></td><td>—</td></tr>
</tbody></table>
</div>
<p>这里性能的衡量方式是在 3.4GHz Haswell CPU 上粗略地进行 <code>u64</code> 类型的输出；
注意性能在不同的应用场景下会明显不同；
一般来说，加密级的 RNGs 会更好地处理字节序列输出。</p>
<p>质量评级是基于理论支持和可观测到的缺陷两个角度，粗略地分成：</p>
<ul>
<li>★☆☆☆☆ = 适合简单的应用场景，但是有具有的缺陷</li>
<li>★★☆☆☆ = 在大多数测试中性能较好，有一些问题</li>
<li>★★★☆☆ = 性能和理论支持都很好，没什么大问题</li>
<li>★★★★★ = 加密级的质量</li>
</ul>
<h2 id="加密级安全的-rngs-csprngs"><a class="header" href="#加密级安全的-rngs-csprngs">加密级安全的 RNGs (CSPRNGs)</a></h2>
<p>CSPRNGs 比基础的 PRNGs 有更高的要求。主要是对安全的考虑。
性能和易用也很重要，但是 CSPRNGs 一般更复杂一些，比常规的 PRNGs 更慢。
质量不再是关心的重点，因为 CSPRNGs 生成的随机数基本上与真的随机值别无二致，
这正是它所要求的。毕竟任何的倾向性或相关性都会让输出结果更容易被预测。</p>
<p>CSPRNGs 和加密密码 (cryptographic ciphers) 具有密切的联系。
任何块密码 (block cipher) 都能转化为对一个计数器 (counter) 加密的 CSPRNG 。
流密码 (stream cipher) 基本上就是一个 CSPRNG 和一组操作（通常是 XOR）。
这意味着，我们能很容易地把任何流密码用作一个 CSPRNG 。</p>
<p>Rand 库提供了以下 CSPRNGs 。可以不再要求任何安全性（因为它们已经是安全的）。
这张表去掉了 “质量” 一列，因为 CSPRNGs 可能不会有可观测到的缺陷。</p>
<div class="table-wrapper"><table><thead><tr><th>名称</th><th>全名</th><th>性能</th><th>初始化</th><th>内存</th><th>安全性（可预测性）</th><th>前向保密性</th></tr></thead><tbody>
<tr><td><a href="https://rust-random.github.io/rand/rand/rngs/struct.StdRng.html"><code>StdRng</code></a></td><td>无</td><td>1.5 GB/s</td><td>快</td><td>136 bytes</td><td>被广泛信赖</td><td>无</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaCha20Rng.html"><code>ChaCha20Rng</code></a></td><td>ChaCha20</td><td>1.8 GB/s</td><td>快</td><td>136 bytes</td><td><a href="https://tools.ietf.org/html/rfc7539#section-1">有严格的分析</a></td><td>无</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaCha8Rng.html"><code>ChaCha8Rng</code></a></td><td>ChaCha8</td><td>2.2 GB/s</td><td>快</td><td>136 bytes</td><td>安全的边界很小</td><td>无</td></tr>
<tr><td><a href="https://rust-random.github.io/rand/rand_hc/struct.Hc128Rng.html"><code>Hc128Rng</code></a></td><td>HC-128</td><td>2.1 GB/s</td><td>慢</td><td>4176 bytes</td><td><a href="http://www.ecrypt.eu.org/stream/">被 eSTREAM 推荐</a></td><td>无</td></tr>
<tr><td><a href="https://docs.rs/rand_isaac/latest/rand_isaac/isaac/struct.IsaacRng.html"><code>IsaacRng</code></a></td><td>ISAAC</td><td>1.1 GB/s</td><td>慢</td><td>2072 bytes</td><td><a href="https://burtleburtle.net/bob/rand/isaacafa.html">未知</a></td><td>未知</td></tr>
<tr><td><a href="https://docs.rs/rand_isaac/latest/rand_isaac/isaac64/struct.Isaac64Rng.html"><code>Isaac64Rng</code></a></td><td>ISAAC-64</td><td>2.2 GB/s</td><td>慢</td><td>4136 bytes</td><td>未知</td><td>未知</td></tr>
</tbody></table>
</div>
<p>应该十分注意，ISAAC 生成器仅出于历史原因使用：
它们从一开始就和 Rust 语言一起被使用，
它们可以良好地生成随机数，也没有被攻击成功过，
但是并未得到加密学专家的关注。</p>
<h1 id="评价生成器"><a class="header" href="#评价生成器">评价生成器</a></h1>
<h2 id="性能"><a class="header" href="#性能">性能</a></h2>
<p>首先，不得不说 Rand 的大多数 PRNGs 非常快，几乎不会出现性能瓶颈。</p>
<p>基础 PRNGs 的性能有些微妙的地方。
它们的性能大多取决于 CPU 架构（32 或 64 位）、内联能力 (inlining) 和 寄存器 (register) 的数量。
性能常常因为内联和其他寄存器的使用情况，而受到上下文代码的影响。</p>
<p>出于性能考虑来选择一个 PRNG 的时候，对你的应用进行基准测试 (benchmark) 是很重要的，
因为 PRNGs 和上下文代码的交互、 CPU 架构以及所需数据的大小都会影响性能。
正因为如此，这里不会用数字来量化性能，而仅仅只是以定性评级的方式来衡量性能。</p>
<p>CSPRNGs 略微特别，因为它们通常在缓存里生成一块输出，然后从缓存中提取输出。
这种方式让 CSPRNGs 很好地摊销掉性能，从而减少或者完全消除了上下文代码对 CSPRNGs 的性能影响。</p>
<h3 id="最坏情况下"><a class="header" href="#最坏情况下">最坏情况下</a></h3>
<p>简单的 PRNGs 一般按需生成单个随机值。
而 CSPRNGs 通常一次生成一整块随机值，然后在这块值消耗完之前，从缓存中读取这些值。
这使得在生成少量随机数据的时候， CSPRNGs 与 PRNGs 的性能差异较大。</p>
<h3 id="内存使用"><a class="header" href="#内存使用">内存使用</a></h3>
<p>简单的 PRNGs 一般使用很少的内存，只需要几个字 (words) ，而一个字一般要么是 <code>u32</code> 要么是 <code>u64</code> 。
然而，也不是说所有非加密级别的 PRNGs 均如此。
比如历史上一度流行的 Mersenne Twister MT19937 算法就需要 2.5 kB (20480 bits) 大小的状态。</p>
<p>CSPRNGs 一般需要更多的内存，因为随机种子的大小建议至少为 192 bits ，
有些算法需要更多 bit 的种子，而 256 bits 是基本满足安全性的种子大小。
实际应用中， CSPRNGs 倾向于使用更多 bits 的种子，
<a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaChaRng.html"><code>ChaChaRng</code></a> 使用 136 bytes (1088 bits) 大小的状态。</p>
<h3 id="初始化时间"><a class="header" href="#初始化时间">初始化时间</a></h3>
<p>初始化新生成器的时间差异很明显。
很多简单的 PRNGs 、甚至某些加密级 PRNGs （包括 <a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaChaRng.html"><code>ChaChaRng</code></a> ）都只需要
把种子的值和一些常量复制进状态里面，因此它们能很快地构造一个生成器。
而具有很大状态的 CSPRNGs 正相反，需要长时间的秘钥展开 (key-expansion) 。</p>
<h2 id="随机数的质量"><a class="header" href="#随机数的质量">随机数的质量</a></h2>
<p>许多基础的 PRNGs 只不过是一些位运算和算术运算。
它们的简单性提供了良好的性能，但也意味着在生成的随机数流中隐藏了一些小的规则。</p>
<p>这些隐藏的规则会造成多大影响呢？
很难讲。那取决于你如何 RNGs 。
随机数和这个随机数所使用的算法碰巧具有相关性的话，
RNGs 的结果可能就不正确，或者是误导的。</p>
<p>当某个 RNG 在许多应用尽可能给出正确的结果时，就被认为是一个好的 RNG 。
PRNG 算法的质量可以在一定程度上用解析 (analytically) 的方法来评估，
以确定周期长度并排除某些相关性。
也有一些基于经验的测试套件，用以测试 RNGs 在各种使用环境中的表现，
其中最新、最完整的是 <a href="http://simul.iro.umontreal.ca/testu01/tu01.html">TestU01</a> 和 <a href="http://pracrand.sourceforge.net/">PractRand</a> 。</p>
<p>CSPRNGs 往往复杂很多，它们明确要求随机值不可预测。
这表明输出值必须完全不相关。</p>
<h3 id="质量得分"><a class="header" href="#质量得分">质量得分</a></h3>
<p>对于大多数非加密级应用的 PRNGs 可以评 3 星或更多。</p>
<p>对于一般的应用和游戏，不能与所有算法一起良好工作的 PRNGs 可以评 1 星或 2 星。</p>
<h3 id="周期长度"><a class="header" href="#周期长度">周期长度</a></h3>
<p>一个 PRNG 的周期 (period) 或周期长度 (cycle length) 指：
在这个 PRNG 开始重复同一个随机数流之后，可被生成的随机值的数量。
许多 PRNGs 具有固定大小的周期，而诸如 chaotic RNGs 的周期长度可能取决于随机种子，
而且其周期可能很短。</p>
<p>要注意，长周期不意味着高质量，比如一个 <code>u128</code> 值的计数就提供了一个合适长度的周期。
但与之相反的是，短周期可能就会有带来问题，尤其在多个 RNGs 同时被使用的时候。
一般而言，建议一个周期至少有 2<sup>128</sup> 那么长。
或者说，一个短周期的 PRNG 应至少有 2<sup>64</sup> 的长度，而且支持多个流 (streams) 。
在 PCG 中，要注意它的流是密切相关的。</p>
<p><strong>避免重复使用值！</strong>
在现代硬件上，一个仅有 2<sup>64</sup> 周期长度的 RNG 可在循环（重复）之前快速生成很长一列随机数。
而当多个 RNGs 并行以各自单独的种子被使用的时候，生成的序列很有可能重复 (overlap) 。
假设一个巨大周期 <code>P</code> 的 RNG，以及 <code>n</code> 个 RNGs ，这 n 个 RNGs 里每个都具有周期 <code>L</code> ，
那么当 <code>nL / P</code> 接近于 0 时，它们所产生的序列出现重复的的概率接近 <code>Ln² / P</code> 。
对这个问题的深入探讨，请参考：
<a href="http://prng.di.unimi.it/#remarks">Xoshiro 作者们的讨论</a> 。</p>
<p><strong>碰撞问题 (collisions) 和生日悖论 (birthday paradox) ！</strong>
如果生成器的输出值与其状态有相同的大小，
那么建议不要让生成器产生多于 <code>√P</code> 数量的随机值（ <code>P</code> 是 RNG 的周期长度）。
一般来说，具有 <code>kw</code>-bit 大小的状态和 <code>w</code>-bit 的 RNG 之间应确保 <code>kL² &lt; P</code> 这样的关系。
这个要求源自于广义的生日问题 (generalised birthday problem) ，
这个问题求从一组大小为 <code>d = 2^w</code> 的总体中应抽取多少样本才能保证出现同一天生日的概率至少为 1/2 。
要注意的是，对于 <code>kL² &gt; P</code> 的情况，虽然具有 <code>kw</code> 维度的均匀分布的 RNG 不可能产生预计重复样本，
但是不是多维均匀分布的 RNGs 也不能包装产生预计重复的数字。</p>
<h2 id="安全性"><a class="header" href="#安全性">安全性</a></h2>
<h3 id="可预测性"><a class="header" href="#可预测性">可预测性</a></h3>
<p>无论哪种 PRNG ，它们都面临一个问题：
<strong>假如已知这个 PRNG 以前的一些输出值，还可能预测接下来的输出值吗？</strong>
在任何可能出现敌手的情况下，（不）可预测性是一个很重要的性质。</p>
<p>常规的 PRNGs 往往可以被预测，虽然预测准确的话可能要经历重重困难。
有些情况下，预测可以轻而易举，比如单纯的 (plain) Xorshift 不加更改地输出其状态的时候，
只需四个 <code>u32</code> 输出值就能像设置了随机种子一样把 Xorshift 完全预测出来。
预测像 <a href="http://www.pcg-random.org/predictability.html">PCG</a> 或者截断式 (truncated) Xorshift
这样的 RNGs 就困难得多，但是利用通常的数学知识和一台台式电脑，还是可以做到预测出它们的。</p>
<p>CSPRNGs 必须提供的最基础的安全保证是：预测输出值是完全不可能的。
这个要求以 <a href="https://en.wikipedia.org/wiki/Next-bit_test">next-bit test</a> 作为检验的标准，简单来说：
给定一串随机序列的前 k bits ，如果没有算法能在合理的计算能力之下预测下一个 bit ，
那么就称这个序列通过了 next-bit 测试。</p>
<p>某些 CSPRNGs 提供了更高的安全要求：向前保密 (forward secrecy) ,
某时刻 CSPRNGs 的状态被暴露的情况下，依然不可能构造之前的状态或者输出值。
注意，许多 CSPRNGs 通常在设计的时候并不考虑向前保密性。</p>
<p>验证某个算法宣称的安全性是一个困难的，Rand 无法保证提供或推荐的算法的安全性。
建议你参考 <a href="https://www.nist.gov/">NIST</a> 机构和 <a href="http://www.ecrypt.eu.org/">ECRYPT</a> 。</p>
<h3 id="状态和种子"><a class="header" href="#状态和种子">状态和种子</a></h3>
<p>值得注意的是，CSPRNGs 的安全性完全取决于提供给它的安全秘钥种子。
如果秘钥已知或者可以被推测，那么这个 CSPRNG 所有的输出值都容易被推测出来。
这意味着种子应该来源于可信赖的地方，通常要么是操作系统，要么是另一个的 CSPRNG 。</p>
<p>Rand 提供的种子辅助 trait <a href="https://rust-random.github.io/rand/rand/trait.FromEntropy.html"><code>FromEntropy</code></a> 和它所使用的 <a href="https://rust-random.github.io/rand/rand/rngs/struct.EntropyRng.html"><code>EntropyRng</code></a> 来源 都应该是安全的。
此外， <a href="https://rust-random.github.io/rand/rand/rngs/struct.ThreadRng.html"><code>ThreadRng</code></a> 是一个 CSPRNG ，所以它可以作为其他算法的种子
（虽然说安全应用应该优先使用全新的/外部的熵）。</p>
<p>更进一步说，一个 CSPRNG 的内部状态显然必须保密。
牢记这点之后，Rand 提供的实现并不直接接触大多数内部状态，
而且 <code>Debug</code> 实现不会打印任何内部状态。
这些还不足以保护 CSPRNGs 的状态；同一个进程内的代码可能读取状态的的内存，
Rand 出于方便，允许复制和序列化 CSPRNGs 。
甚至，运行中的进程可能被操作系统复制 (fork) ，这可能使两个进程具有同一生成器的复制品。</p>
<h3 id="非加密级库"><a class="header" href="#非加密级库">非加密级库</a></h3>
<p>必须强调的一点是，Rand 不是一个达到加密级别库 (cryptography library)，
虽然 Rand 采取一些方式来提供安全的随机数，但它不一定会采取所有推荐做法。
而且像加密 (encryption) 和验证 (authentication) 这样的加密过程 (cryptographic processes)
十分复杂，必须非常小心地实现才能避免纰漏和抵抗已知的攻击。
所以建议尽可能使用专门用于加密领域的库，比如 <a href="https://crates.io/crates/openssl">openssl</a> 、 <a href="https://crates.io/crates/ring">ring</a> 和 <a href="https://github.com/RustCrypto">RustCrypto libraries</a> 。</p>
<h2 id="额外特性"><a class="header" href="#额外特性">额外特性</a></h2>
<p>某些 PRNGs 可能提供一些额外的特性，比如：</p>
<ul>
<li>支持多流，因而可以完成并行任务</li>
<li>可以在随机数流中跳转或寻找；具有很大的周期，从而可用来替代流。</li>
</ul>
<h2 id="延伸阅读"><a class="header" href="#延伸阅读">延伸阅读</a></h2>
<p>关于 PRNGs 还有很多可以说的。
这篇 <a href="http://www.pcg-random.org/pdf/hmc-cs-2014-0905.pdf">PCG paper</a> 非常容易理解，而且解释了更多概念。</p>
<p>另一篇关于 RNG 质量的 paper 是
<a href="https://web.archive.org/web/20160801142711/http://random.mat.sbg.ac.at/results/peter/A19final.pdf">好的 RNG 很（不）容易发现</a><sup class="footnote-reference"><a href="#RNG-paper">1</a></sup></p>
<div class="footnote-definition" id="RNG-paper"><sup class="footnote-definition-label">1</sup>
<p><em>Good random number generators are (not so) easy to find</em></p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="guide-gen.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="guide-seeding.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="guide-gen.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="guide-seeding.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/pagetoc.js"></script>


    </body>
</html>
