<!DOCTYPE html><html><head><meta charset="utf-8"><title>Go socket编程实践: TCP服务器和客户端实现</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="这篇文章主要使用Go语言实现一个简单的TCP服务器和客户端。服务器和客户端之间的协议是 ECHO, 这个RFC 862定义的一个简单协议。为什么说这个协议很简单呢， 这是因为服务器只需把收到的客户端的请求数据发给这个客户端即可，其它什么功能都不做。
首先声明， 我绝对是一个Golang的初学者，十四、五年的编程时间我主要使用Java来做开发，这篇文章主要记录我学习go网络编程的体验。如果你认为这篇"><meta property="og:type" content="article"><meta property="og:title" content="Go socket编程实践: TCP服务器和客户端实现"><meta property="og:url" content="https://colobu.com/2014/12/02/go-socket-programming-TCP/"><meta property="og:site_name" content="鸟窝"><meta property="og:description" content="这篇文章主要使用Go语言实现一个简单的TCP服务器和客户端。服务器和客户端之间的协议是 ECHO, 这个RFC 862定义的一个简单协议。为什么说这个协议很简单呢， 这是因为服务器只需把收到的客户端的请求数据发给这个客户端即可，其它什么功能都不做。
首先声明， 我绝对是一个Golang的初学者，十四、五年的编程时间我主要使用Java来做开发，这篇文章主要记录我学习go网络编程的体验。如果你认为这篇"><meta property="og:image" content="http://jan.newmarch.name/go/arch/iso.gif"><meta property="og:image" content="http://jan.newmarch.name/go/arch/tcp_stack.gif"><meta property="og:image" content="http://jan.newmarch.name/go/zh/Images/packets.gif"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Go socket编程实践: TCP服务器和客户端实现"><meta name="twitter:description" content="这篇文章主要使用Go语言实现一个简单的TCP服务器和客户端。服务器和客户端之间的协议是 ECHO, 这个RFC 862定义的一个简单协议。为什么说这个协议很简单呢， 这是因为服务器只需把收到的客户端的请求数据发给这个客户端即可，其它什么功能都不做。
首先声明， 我绝对是一个Golang的初学者，十四、五年的编程时间我主要使用Java来做开发，这篇文章主要记录我学习go网络编程的体验。如果你认为这篇"><link rel="alternative" href="/atom.xml" title="鸟窝" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/style.css" type="text/css"><link href="//cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/css/jquery.fancybox.min.css" media="screen" type="text/css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" media="screen" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css"></head><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap" class="animated bounceInLeft"><a href="/" id="logo">鸟窝</a></h1><h2 id="subtitle-wrap" class="animated bounceInLeft"><a href="/" id="subtitle">大道至简 Simplicity is the ultimate form of sophistication</a></h2></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/"><i class="fa fa-home">&nbsp;</i>首页</a> <a class="main-nav-link" href="/archives"><i class="fa fa-folder-o">&nbsp;</i>归档</a> <a class="main-nav-link" href="https://github.com/smallnest"><i class="fa fa-github">&nbsp;</i>github</a><div class="dropdown main-nav-link"><a class="main-nav-link" href="#"><i class="fa fa-bars">&nbsp;</i>网站群</a><div class="dropdown-content"><a href="/goasm"><i class="fa fa-language"></i>&nbsp;Go汇编示例</a> <a href="https://gowebexamples.com"><i class="fa fa-external-link"></i>&nbsp;Go Web开发示例</a> <a href="http://go-database-sql.org"><i class="fa fa-external-link"></i>&nbsp;Go 数据库开发教程</a><hr><a href="http://rpcx.io"><i class="fa undefined"></i>&nbsp;RPCX官网</a> <a href="http://cn.doc.rpcx.io"><i class="fa undefined"></i>&nbsp;RPC开发指南</a></div></div><a class="main-nav-link" href="/ScalaCollectionsCookbook"><i class="fa fa-book">&nbsp;</i>Scala集合技术手册</a> <a class="main-nav-link" href="/about"><i class="fa fa-lemon-o">&nbsp;</i>关于</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="Search"></a></nav><div id="search-form-wrap"><form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form"><input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search"> <input type="submit" class="search-form-submit"> <input name="tn" type="hidden" value="bds"> <input name="cl" type="hidden" value="3"> <input name="ct" type="hidden" value="2097152"> <input type="hidden" name="si" value="colobu.com"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-go-socket-programming-TCP" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2014/12/02/go-socket-programming-TCP/" class="article-date"><time datetime="2014-12-02T07:25:40.000Z" itemprop="datePublished">2014年12月02日</time></a><div class="article-category"><a class="article-category-link" href="/categories/Go/">Go</a></div><div class="article-author">by smallnest</div></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Go socket编程实践: TCP服务器和客户端实现</h1></header><div class="article-entry" itemprop="articleBody"><script>function show_answer(e,l){"显示答案"===e.value?e.value="隐藏答案":e.value="显示答案";var n=document.getElementById(l);"none"===n.style.display?n.style.display="block":n.style.display="none"}</script><p>这篇文章主要使用Go语言实现一个简单的TCP服务器和客户端。<br>服务器和客户端之间的协议是 <a href="http://tools.ietf.org/html/rfc862" target="_blank" rel="external">ECHO</a>, 这个RFC 862定义的一个简单协议。<br>为什么说这个协议很简单呢， 这是因为服务器只需把收到的客户端的请求数据发给这个客户端即可，其它什么功能都不做。</p><p>首先声明， 我绝对是一个Golang的初学者，十四、五年的编程时间我主要使用Java来做开发，这篇文章主要记录我学习go网络编程的体验。如果你认为这篇文章有错误或者不好的写法，请在回复中添加你的意见。<br><a id="more"></a></p><h3 id="简单介绍">简单介绍</h3><p>尽管OSI（开放系统互联）协议从未被完整地实现过，但它仍对分布式系统的讨论和设计产生了十分重要的影响。它的结构大致为下图所示：<br><img src="http://jan.newmarch.name/go/arch/iso.gif" alt=""><br>当OSI标准模型正在为实现细节闹得不可开交时，DARPA互联网技术项目却在忙着构建TCP/IP协议。它们取得了极大的成功，并引领了Internet（首字母大写），因为这是个更简单的层次结构：<br><img src="http://jan.newmarch.name/go/arch/tcp_stack.gif" alt=""><br>尽管现在到处都是TCP/IP协议，但它并不是唯一存在的。还有些协议占有重要的地位，比如:</p><ul><li>Firewire</li><li>USB</li><li>Bluetooth</li><li>WiFi</li></ul><p>多年的发展，使得IP和TCP/UDP协议基本上就等价于网络协议栈。例如, 蓝牙定义了物理层和协议层，但在其上任然是IP协议栈，可以在许多蓝牙设备之间使用互联网编程技术。同样, 开发4G无线手机技术，如LTE（Long Term Evolution）也将使用IP协议栈。</p><p>在OIS或TCP/IP协议栈层与层之间的通信，是通过将数据包从一个层发送到下一个层，最终穿过整个网络的。每一层都有必须保持其自身层的管理信息。从上层接收到的数据包在向下传递时，会添加头信息。在接收端，这些头信息会在向上传递时移除。<br>例如，TFTP（普通文件传输协议）将文件从一台计算机移动到另一台上。它使用IP协议上的UDP协议，该协议可通过以太网发送。看起来就像这样<br><img src="http://jan.newmarch.name/go/zh/Images/packets.gif" alt=""><br>最终在以太网上传输的数据，就是图中最底层的那个数据。</p><p>为了两个计算机进行通信，就必须建立一个路径，使他们能够在一个会话中发送至少一条消息。有两个主要的模型：</p><ul><li>面向连接模型, 如TCP</li><li>无连接模型, 如UDP， IP</li></ul><p>服务运行在主机。通常它们的生命期很长，同时被设计成等待请求和响应请求。当前有各种类型的服务，通过各种方法向客户提供服务。互联网的世界基于TCP和UDP这两种通信方法提供许多这些服务，虽然也有其他通信协议如SCTP​​伺机取代。许多其他类型的服务，例如点对点, 远过程调用, 通信代理, 和许多其他也建立在TCP和UDP之上。</p><p>服务存活于主机内。IP地址可以定位主机。但在每台计算机上可能会提供多种服务，需要一个简单的方法对它们加以区分。TCP，UDP，SCTP或者其他协议使用端口号来加以区分。这里使用一个1到65,535的无符号整数，每个服务将这些端口号中的一个或多个相关联。</p><p>有很多“标准”的端口。Telnet服务通常使用端口号23的TCP协议。DNS使用端口号53的TCP或UDP协议。FTP使用端口21和20的命令，进行数据传输。HTTP通常使用端口80，但经常使用，端口8000，8080和8088，协议为TCP。X Window系统往往需要端口6000-6007，TCP和UDP协议。</p><p>在Unix系统中, /etc/services文件列出了常用的端口。Go语言有一个函数可以获取该文件。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">func</span> LookupPort(network, service <span class="typename">string</span>) (port <span class="typename">int</span>, err os.Error)</div></pre></td></tr></table></figure><p>Go提供IP， IP掩码， TCPAddr， UDPAddr， 网卡，主机查询这些对象的操作函数。</p><p>当你知道如何通过网络和端口ID查找一个服务时，然后呢？如果你是一个客户端，你需要一个API，让您连接到服务，然后将消息发送到该服务，并从服务读取回复。<br>如果你是一个服务器，你需要能够绑定到一个端口，并监听它。当有消息到来，你需要能够读取它并回复客户端。</p><p><code>net.TCPConn</code>是允许在TCP客户端和TCP服务器之间的全双工通信的Go类型。两种主要方法是</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">func</span> (c *TCPConn) Write(b []<span class="typename">byte</span>) (n <span class="typename">int</span>, err os.Error)</div><div class="line"><span class="keyword">func</span> (c *TCPConn) Read(b []<span class="typename">byte</span>) (n <span class="typename">int</span>, err os.Error)</div></pre></td></tr></table></figure><p>TCPConn被客户端和服务器用来读写消息。</p><h3 id="ECHO服务器">ECHO服务器</h3><p>在一个服务器上注册并监听一个端口。然后它阻塞在一个&quot;accept&quot;操作，并等待客户端连接。当一个客户端连接, accept调用返回一个连接(connection)对象。ECHO服务非常简单，只是客户端, 关闭该连接的请求数据写回到客户端，就像回声一样，直到某一方关闭连接。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">func</span> ListenTCP(net <span class="typename">string</span>, laddr *TCPAddr) (l *TCPListener, err os.Error)</div><div class="line"><span class="keyword">func</span> (l *TCPListener) Accept() (c Conn, err os.Error)</div></pre></td></tr></table></figure><p>net参数可以设置为字符串&quot;tcp&quot;, &quot;tcp4&quot;或者&quot;tcp6&quot;中的一个。如果你想监听所有网络接口，IP地址应设置为0。 如果你只是想监听一个特定网络接口，IP地址可以设置为该网络接口的地址。如果端口设置为0，操作系统会为你选择一个端口。否则，你可以选择你自己的。需要注意的是，在Unix系统上，除非你是监控系统，否则不能监听低于1024的端口，小于128的端口是由IETF标准化。该示例程序选择端口1200没有特别的原因。TCP地址如下&quot;:1200&quot; - 所有网络接口, 端口1200。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"flag"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"net"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> host = flag.String(<span class="string">"host"</span>, <span class="string">""</span>, <span class="string">"host"</span>)</div><div class="line"><span class="keyword">var</span> port = flag.String(<span class="string">"port"</span>, <span class="string">"3333"</span>, <span class="string">"port"</span>)</div><div class="line"></div><div class="line"><span class="keyword">func</span> main() {</div><div class="line">	flag.Parse()</div><div class="line">	<span class="keyword">var</span> l net.Listener</div><div class="line">	<span class="keyword">var</span> err error</div><div class="line">	l, err = net.Listen(<span class="string">"tcp"</span>, *host+<span class="string">":"</span>+*port)</div><div class="line">	<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">		fmt.Println(<span class="string">"Error listening:"</span>, err)</div><div class="line">		os.Exit<span class="number">(1</span>)</div><div class="line">	}</div><div class="line">	<span class="keyword">defer</span> l.Close()</div><div class="line">	fmt.Println(<span class="string">"Listening on "</span> + *host + <span class="string">":"</span> + *port)</div><div class="line"></div><div class="line">	<span class="keyword">for</span> {</div><div class="line">		conn, err := l.Accept()</div><div class="line">		<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">			fmt.Println(<span class="string">"Error accepting: "</span>, err)</div><div class="line">			os.Exit<span class="number">(1</span>)</div><div class="line">		}</div><div class="line"></div><div class="line">		<span class="comment">//logs an incoming message</span></div><div class="line">		fmt.Printf(<span class="string">"Received message %s -&gt; %s \n"</span>, conn.RemoteAddr(), conn.LocalAddr())</div><div class="line"></div><div class="line">		<span class="comment">// Handle connections in a new goroutine.</span></div><div class="line">		<span class="keyword">go</span> handleRequest(conn)</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">func</span> handleRequest(conn net.Conn) {</div><div class="line">	<span class="keyword">defer</span> conn.Close()</div><div class="line"></div><div class="line">	<span class="keyword">for</span> {</div><div class="line">		io.Copy(conn, conn)</div><div class="line">	}</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure><p>执行<code>go run echoserver.go</code>启动服务器。</p><h3 id="ECHO客户端">ECHO客户端</h3><p>一旦客户端已经建立TCP服务, 就可以&quot;拨号&quot;了. 如果成功，该调用返回一个用于通信的<code>TCPConn</code>。客户端和服务器通过它交换消息。通常情况下，客户端使用<code>TCPConn</code>写入请求到服务器, 并从<code>TCPConn</code>的读取响应。持续如此，直到任一（或两者）的两侧关闭连接。客户端使用该函数建立一个TCP连接。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">func</span> DialTCP(net <span class="typename">string</span>, laddr, raddr *TCPAddr) (c *TCPConn, err os.Error)</div></pre></td></tr></table></figure><p>其中<code>laddr</code>是本地地址，通常设置为<strong>nil</strong>。 <code>raddr</code>是一个服务的远程地址, net是一个字符串，可以根据你的需要设置为&quot;tcp4&quot;, &quot;tcp6&quot;或&quot;tcp&quot;中的一个。</p><p>在介绍实现时，我们需要介绍同步机制， 因为客户端发送和接收是在两个goroutine中。 main函数中如果不加上同步机制， 客户端还没有发送接收就执行完了。<br>我们实现了两种同步方式。 当然还有其它方式， 如<code>time.Sleep(60*1000)</code>或者等待从命令行输入,不过看起来有点傻。</p><blockquote><p>Go格言<br>Share memory by communicating, don&#39;t communicate by sharing memory</p></blockquote><h4 id="使用Channel等待goroutine完成">使用Channel等待goroutine完成</h4><p>比如老套的方式通过channel实现同步。 读和写完成后分别往channel中写入&quot;done&quot;。 main读取channel中的值，当两个done都读取到后就知道读写已经完成。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"flag"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"net"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"strconv"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> host = flag.String(<span class="string">"host"</span>, <span class="string">"localhost"</span>, <span class="string">"host"</span>)</div><div class="line"><span class="keyword">var</span> port = flag.String(<span class="string">"port"</span>, <span class="string">"3333"</span>, <span class="string">"port"</span>)</div><div class="line"></div><div class="line"><span class="keyword">func</span> main() {</div><div class="line">	flag.Parse()</div><div class="line">	conn, err := net.Dial(<span class="string">"tcp"</span>, *host+<span class="string">":"</span>+*port)</div><div class="line">	<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">		fmt.Println(<span class="string">"Error connecting:"</span>, err)</div><div class="line">		os.Exit<span class="number">(1</span>)</div><div class="line">	}</div><div class="line">	<span class="keyword">defer</span> conn.Close()</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"Connecting to "</span> + *host + <span class="string">":"</span> + *port)</div><div class="line"></div><div class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">string</span>)</div><div class="line">	<span class="keyword">go</span> handleWrite(conn, done)</div><div class="line">	<span class="keyword">go</span> handleRead(conn, done)</div><div class="line"></div><div class="line">	fmt.Println(&lt;-done)</div><div class="line">	fmt.Println(&lt;-done)</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">func</span> handleWrite(conn net.Conn, done <span class="keyword">chan</span> <span class="typename">string</span>) {</div><div class="line">	<span class="keyword">for</span> i :=<span class="number"> 10</span>; i &gt;<span class="number"> 0</span>; i-- {</div><div class="line">		_, e := conn.Write([]<span class="typename">byte</span>(<span class="string">"hello "</span> + strconv.Itoa(i) + <span class="string">"\r\n"</span>))</div><div class="line"></div><div class="line">		<span class="keyword">if</span> e != <span class="constant">nil</span> {</div><div class="line">			fmt.Println(<span class="string">"Error to send message because of "</span>, e.Error())</div><div class="line">			<span class="keyword">break</span></div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	done &lt;- <span class="string">"Sent"</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">func</span> handleRead(conn net.Conn, done <span class="keyword">chan</span> <span class="typename">string</span>) {</div><div class="line">	buf := <span class="built_in">make</span>([]<span class="typename">byte</span>,<span class="number"> 1024</span>)</div><div class="line">	reqLen, err := conn.Read(buf)</div><div class="line">	<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">		fmt.Println(<span class="string">"Error to read message because of "</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	}</div><div class="line">	fmt.Println(<span class="typename">string</span>(buf[:reqLen<span class="number">-1</span>]))</div><div class="line"></div><div class="line">	done &lt;- <span class="string">"Read"</span></div><div class="line">}</div></pre></td></tr></table></figure><p><code>net.Dial</code>建立连接， <code>handleWrite</code>发送十个请求， <code>handleRead</code> 接收服务器的响应。一旦完成，往channel中写done。<br>执行<code>go run echoclient.go</code>启动服务器。</p><h4 id="使用WaitGroup等待goroutine完成">使用WaitGroup等待goroutine完成</h4><p>上面的方式虽好，但是不够灵活。我们需要明确知道有多少个done。 如果增加若干个goroutine，修改起来比较麻烦。<br>所以还是使用<code>sync</code>包的<code>WaitGroup</code>比较灵活。 它类似Java中的CountDownLatch。</p><blockquote><p>A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait can be used to block until all goroutines have finished.</p></blockquote><p>将上面的例子修改如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bufio"</span></div><div class="line">	<span class="string">"flag"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"net"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"strconv"</span></div><div class="line">	<span class="string">"sync"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> host = flag.String(<span class="string">"host"</span>, <span class="string">"localhost"</span>, <span class="string">"host"</span>)</div><div class="line"><span class="keyword">var</span> port = flag.String(<span class="string">"port"</span>, <span class="string">"3333"</span>, <span class="string">"port"</span>)</div><div class="line"></div><div class="line"><span class="keyword">func</span> main() {</div><div class="line">	flag.Parse()</div><div class="line">	conn, err := net.Dial(<span class="string">"tcp"</span>, *host+<span class="string">":"</span>+*port)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">		fmt.Println(<span class="string">"Error connecting:"</span>, err)</div><div class="line">		os.Exit<span class="number">(1</span>)</div><div class="line">	}</div><div class="line">	<span class="keyword">defer</span> conn.Close()</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"Connecting to "</span> + *host + <span class="string">":"</span> + *port)</div><div class="line"></div><div class="line">	<span class="keyword">var</span> wg sync.WaitGroup</div><div class="line">	wg.Add<span class="number">(2</span>)</div><div class="line"></div><div class="line">	<span class="keyword">go</span> handleWrite(conn, &wg)</div><div class="line">	<span class="keyword">go</span> handleRead(conn, &wg)</div><div class="line"></div><div class="line">	wg.Wait()</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">func</span> handleWrite(conn net.Conn, wg *sync.WaitGroup) {</div><div class="line">	<span class="keyword">defer</span> wg.Done()</div><div class="line"></div><div class="line">	<span class="keyword">for</span> i :=<span class="number"> 10</span>; i &gt;<span class="number"> 0</span>; i-- {</div><div class="line">		_, e := conn.Write([]<span class="typename">byte</span>(<span class="string">"hello "</span> + strconv.Itoa(i) + <span class="string">"\r\n"</span>))</div><div class="line"></div><div class="line">		<span class="keyword">if</span> e != <span class="constant">nil</span> {</div><div class="line">			fmt.Println(<span class="string">"Error to send message because of "</span>, e.Error())</div><div class="line">			<span class="keyword">break</span></div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">func</span> handleRead(conn net.Conn, wg *sync.WaitGroup) {</div><div class="line">	<span class="keyword">defer</span> wg.Done()</div><div class="line"></div><div class="line">	reader := bufio.NewReader(conn)</div><div class="line">	<span class="keyword">for</span> i :=<span class="number"> 1</span>; i &lt;=<span class="number"> 10</span>; i++ {</div><div class="line">		line, err := reader.ReadString(<span class="typename">byte</span>(<span class="string">'\n'</span>))</div><div class="line">		<span class="keyword">if</span> err != <span class="constant">nil</span> {</div><div class="line">			fmt.Print(<span class="string">"Error to read message because of "</span>, err)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		}</div><div class="line">		fmt.Print(line)</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure><p><code>wg.Add(2)</code>设定等待两个goroutines, 然后调用<code>wg.Wait()</code>等待goroutines完成。 当goroutine完成时， 调用<code>wg.Done()</code>。 使用起来相当简洁。</p><h3 id="参考">参考</h3><ol><li><a href="http://tools.ietf.org/html/rfc862" target="_blank" rel="external">http://tools.ietf.org/html/rfc862</a></li><li><a href="http://loige.com/simple-echo-server-written-in-go-dockerized/" target="_blank" rel="external">http://loige.com/simple-echo-server-written-in-go-dockerized/</a></li><li><a href="http://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/" target="_blank" rel="external">http://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/</a></li><li><a href="http://jan.newmarch.name/go/zh/" target="_blank" rel="external">http://jan.newmarch.name/go/zh/</a></li><li><a href="https://talks.golang.org/2012/concurrency.slide" target="_blank" rel="external">https://talks.golang.org/2012/concurrency.slide</a></li><li><a href="http://jimmyfrasche.github.io/go-reflection-codex/" target="_blank" rel="external">http://jimmyfrasche.github.io/go-reflection-codex/</a></li><li><a href="https://sites.google.com/site/gopatterns/" target="_blank" rel="external">https://sites.google.com/site/gopatterns/</a></li><li><a href="https://github.com/golang-samples" target="_blank" rel="external">https://github.com/golang-samples</a></li><li><a href="http://golang-examples.tumblr.com/" target="_blank" rel="external">http://golang-examples.tumblr.com/</a></li><li><a href="https://code.google.com/p/go-wiki/wiki/Articles" target="_blank" rel="external">https://code.google.com/p/go-wiki/wiki/Articles</a></li><li><a href="https://github.com/mindreframer/golang-stuff" target="_blank" rel="external">https://github.com/mindreframer/golang-stuff</a></li></ol></div><footer class="article-footer"><section id="comments"><script src="https://utteranc.es/client.js" repo="smallnest/gitalk" issue-term="title" theme="github-light" crossorigin="anonymous" async></script><noscript>为正常使用评论功能请激活JavaScript</noscript></section></footer></div><nav id="article-nav"><a href="/2014/12/02/go-socket-programming-UDP/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Go socket编程实践: UDP服务器和客户端实现</div></a> <a href="/2014/11/27/java-collections-overview/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Java集合总览</div></a></nav></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">微信公众号</h3><div class="widget"><img width="100%" src="/images/widgets/gopatterns.jpg"></div></div><div class="widget-wrap"><h3 class="widget-title">极客时间专栏</h3><div class="widget"><a href="https://time.geekbang.org/column/intro/100061801"><img width="100%" src="/images/widgets/geekbang.png"></a></div></div><div class="widget-wrap"><h3 class="widget-title">原创图书</h3><div class="widget"><a href="/ScalaCollectionsCookbook/"><img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook.jpg"> <img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook_tw.png"></a></div></div><div class="widget-wrap"><h3 class="widget-title">分类</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DOTNET/">DOTNET</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">197</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rust/">Rust</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Scala/">Scala</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分享/">分享</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/">前端开发</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/区块链/">区块链</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/管理/">管理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络编程/">网络编程</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发编程/">高并发编程</a><span class="category-list-count">20</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"><a href="/tags/Android/" style="font-size: 15.71px">Android</a><a href="/tags/ApacheBench/" style="font-size: 11.43px">ApacheBench</a><a href="/tags/Bower/" style="font-size: 10.00px">Bower</a><a href="/tags/C/" style="font-size: 10.00px">C#</a><a href="/tags/CDN/" style="font-size: 10.00px">CDN</a><a href="/tags/CQRS/" style="font-size: 10.00px">CQRS</a><a href="/tags/CRC/" style="font-size: 10.00px">CRC</a><a href="/tags/CSS/" style="font-size: 11.43px">CSS</a><a href="/tags/CompletableFuture/" style="font-size: 10.00px">CompletableFuture</a><a href="/tags/Comsat/" style="font-size: 10.00px">Comsat</a><a href="/tags/Curator/" style="font-size: 18.57px">Curator</a><a href="/tags/DSL/" style="font-size: 10.00px">DSL</a><a href="/tags/Disruptor/" style="font-size: 10.00px">Disruptor</a><a href="/tags/Docker/" style="font-size: 11.43px">Docker</a><a href="/tags/Ember/" style="font-size: 11.43px">Ember</a><a href="/tags/FastJson/" style="font-size: 10.00px">FastJson</a><a href="/tags/Fiber/" style="font-size: 10.00px">Fiber</a><a href="/tags/GAE/" style="font-size: 10.00px">GAE</a><a href="/tags/GC/" style="font-size: 12.86px">GC</a><a href="/tags/Gnuplot/" style="font-size: 10.00px">Gnuplot</a><a href="/tags/Go/" style="font-size: 14.29px">Go</a><a href="/tags/Gradle/" style="font-size: 10.00px">Gradle</a><a href="/tags/Grunt/" style="font-size: 10.00px">Grunt</a><a href="/tags/Gulp/" style="font-size: 10.00px">Gulp</a><a href="/tags/Hadoop/" style="font-size: 10.00px">Hadoop</a><a href="/tags/Hazelcast/" style="font-size: 10.00px">Hazelcast</a><a href="/tags/IPFS/" style="font-size: 10.00px">IPFS</a><a href="/tags/Ignite/" style="font-size: 10.00px">Ignite</a><a href="/tags/JVM/" style="font-size: 10.00px">JVM</a><a href="/tags/Java/" style="font-size: 17.14px">Java</a><a href="/tags/Kafka/" style="font-size: 20.00px">Kafka</a><a href="/tags/Lambda/" style="font-size: 14.29px">Lambda</a><a href="/tags/Linux/" style="font-size: 12.86px">Linux</a><a href="/tags/LongAdder/" style="font-size: 10.00px">LongAdder</a><a href="/tags/MathJax/" style="font-size: 10.00px">MathJax</a><a href="/tags/Maven/" style="font-size: 11.43px">Maven</a><a href="/tags/Memcached/" style="font-size: 10.00px">Memcached</a><a href="/tags/Metrics/" style="font-size: 10.00px">Metrics</a><a href="/tags/Mongo/" style="font-size: 12.86px">Mongo</a><a href="/tags/Netty/" style="font-size: 15.71px">Netty</a></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">近期文章</h3><div class="widget"><ul><li><a href="/2022/08/30/waitgroup-to-love-to-toss/">爱折腾的WaitGroup</a></li><li><a href="/2022/08/25/some-small-optimizations-of-rpcx/">最近对rpcx做的一些优化以及一些优化尝试</a></li><li><a href="/2022/07/31/2022-rpc-frameworks-benchmarks/">2022 Go生态圈 rpc 框架 Benchmark</a></li><li><a href="/2022/07/16/A-Guide-to-the-Go-Garbage-Collector/">Go 垃圾回收器指南</a></li><li><a href="/2022/06/26/distributed-system-design-patterns/">分布式系统设计模式</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">友情链接</h3><div class="widget"><ul><li><a href="http://stackshare.io" target="_blank">技术栈</a></li><li>&nbsp;</li><li><a href="https://toutiao.io/" target="_blank">开发者头条</a></li><li><a href="http://weekly.manong.io/issues/" target="_blank">码农周刊</a></li><li><a href="http://www.tuicool.com/mags" target="_blank">编程狂人周刊</a></li><li><a href="http://www.importnew.com/" target="_blank">importnew</a></li><li><a href="http://ifeve.com/" target="_blank">并发编程网</a></li><li>&nbsp;</li><li><a href="http://github.com" target="_blank">github</a></li><li><a href="http://stackoverflow.com/" target="_blank">stackoverflow</a></li><li><a href="http://www.javacodegeeks.com/" target="_blank">javacodegeeks</a></li><li><a href="http://www.infoq.com/" target="_blank">infoq</a></li><li><a href="http://www.dzone.com/links/index.html" target="_blank">dzone</a></li><li><a href="https://oj.leetcode.com/problems/" target="_blank">leetcode</a></li><li><a href="http://tutorials.jenkov.com" target="_blank">jenkov</a></li><li><a href="https://howtodoinjava.com" target="_blank">HowToDoInJava</a></li><li><a href="https://java-design-patterns.com/patterns/" target="_blank">java design patterns</a></li><li>&nbsp;</li><li><a href="https://medium.com/netflix-techblog" target="_blank">Netflix技术博客</a></li><li><a href="https://www.techiedelight.com" target="_blank">Techie Delight</a></li><li><a href="https://engineering.linkedin.com/blog" target="_blank">Linkedin技术博客</a></li><li><a href="https://blogs.dropbox.com/tech/" target="_blank">Dropbox技术博客</a></li><li><a href="https://code.fb.com" target="_blank">Facebook技术博客</a></li><li><a href="http://jm.taobao.org" target="_blank">淘宝中间件团队</a></li><li><a href="https://tech.meituan.com" target="_blank">美团技术博客</a></li><li><a href="http://blogs.360.cn" target="_blank">360技术博客</a></li><li><a href="https://xiaomi-info.github.io" target="_blank">小米信息部技术团队</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2022 smallnest<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link"><i class="fa fa-home">&nbsp;</i>首页</a> <a href="/archives" class="mobile-nav-link"><i class="fa fa-folder-o">&nbsp;</i>归档</a> <a href="https://github.com/smallnest" class="mobile-nav-link"><i class="fa fa-github">&nbsp;</i>github</a> <a class="mobile-nav-link" href="#"><i class="fa fa-bars">&nbsp;</i>网站群</a> <a class="mobile-nav-link" href="/goasm">&nbsp;&nbsp;<i class="fa fa-language">&nbsp;</i>Go汇编示例</a> <a class="mobile-nav-link" href="https://gowebexamples.com">&nbsp;&nbsp;<i class="fa fa-external-link">&nbsp;</i>Go Web开发示例</a> <a class="mobile-nav-link" href="http://go-database-sql.org">&nbsp;&nbsp;<i class="fa fa-external-link">&nbsp;</i>Go 数据库开发教程</a> <a class="mobile-nav-link" href="http://rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPCX官网</a> <a class="mobile-nav-link" href="http://cn.doc.rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPC开发指南</a> <a href="/ScalaCollectionsCookbook" class="mobile-nav-link"><i class="fa fa-book">&nbsp;</i>Scala集合技术手册</a> <a href="/about" class="mobile-nav-link"><i class="fa fa-lemon-o">&nbsp;</i>关于</a></nav><script src="//cdn.staticfile.org/jquery/1.11.1/jquery.min.js"></script><script src="//cdn.bootcss.com/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script><script src="/js/script.js" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]}}),MathJax.Hub.Queue(function(){var a,e=MathJax.Hub.getAllJax();for(a=0;a<e.length;a+=1)e[a].SourceElement().parentNode.className+=" has-jax"});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.6.0-beta.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="totop" style="position:fixed;bottom:150px;right:10px;cursor: pointer;z-index: 2000"><a title="返回顶部"><img src="/images/scrollup.png"></a></div><script src="/js/totop.js" type="text/javascript"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e085d87993250aab11f3e0c15f1c2785";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();</script></div></body></html>