<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  
  <title>在 Rust 中同时支持异步和同步代码</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="来，过路人，请坐到我身边来，听老衲讲一讲我对 Rust 过分要求的故事。">
<meta property="og:type" content="article">
<meta property="og:title" content="在 Rust 中同时支持异步和同步代码">
<meta property="og:url" content="https://colobu.com/2024/08/28/rust-async-sync/">
<meta property="og:site_name" content="鸟窝">
<meta property="og:description" content="来，过路人，请坐到我身边来，听老衲讲一讲我对 Rust 过分要求的故事。">
<meta property="og:image" content="https://nullderef.com/blog/rust-async-sync/preview.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在 Rust 中同时支持异步和同步代码">
<meta name="twitter:description" content="来，过路人，请坐到我身边来，听老衲讲一讲我对 Rust 过分要求的故事。">

  
  <link rel="alternative" href="/atom.xml" title="鸟窝" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../../../css/style.css" type="text/css">

  <link href="//cdn.bootcdn.net/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/css/jquery.fancybox.min.css"
    media="screen" type="text/css">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" media="screen"
    type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap" class="animated bounceInLeft">
        <a href="../../../.." id="logo">鸟窝</a>
      </h1>
      
        <!-- <h2 id="subtitle-wrap" class="animated bounceInLeft"> -->
        <h2 id="subtitle-wrap">
          <!-- <a href="../../../.." id="subtitle">大道至简 Simplicity is the ultimate form of sophistication</a> -->
          <a href="https://item.jd.com/14283252.html" target="_blank" style="color: #e32d40;text-decoration: none;"><b>《Go語言全功能開發養成書》繁体中文版发售。一书在手，并发无忧</b></a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="../../../.."><i class="fa fa-home">&nbsp;</i>首页</a>
          
          
          
            <a class="main-nav-link" href="../../../../archives"><i class="fa fa-regular fa-folder-open">&nbsp;</i>归档</a>
          
          
          
            <a class="main-nav-link" href="https://github.com/smallnest"><i class="fa fa-brands fa-github-alt">&nbsp;</i>github</a>
          
          
          
            <div class="dropdown main-nav-link"><a class="main-nav-link" href="#"><i class="fa fa-brands fa-golang">&nbsp;</i>Go学习资源</a>
              <div class="dropdown-content">
          
            
              <a href="/goasm"><i class="fa fa-brands fa-golang"></i>&nbsp;Go汇编示例</a>
            
                
          
            
              <a href="https://gowebexamples.com"><i class="fa fa-brands fa-golang"></i>&nbsp;Go Web开发示例</a>
            
                
          
            
              <a href="http://go-database-sql.org"><i class="fa fa-brands fa-golang"></i>&nbsp;Go 数据库开发教程</a>
            
                
          
            
              <a href="https://colobu.com/gotips/"><i class="fa fa-brands fa-golang"></i>&nbsp;Go 语言编程技巧</a>
            
                
          
            
              <hr>
            
                
          
            
              <a href="http://rpcx.io"><i class="fa undefined"></i>&nbsp;RPCX官网</a>
            
                
          
            
              <a href="http://cn.doc.rpcx.io"><i class="fa undefined"></i>&nbsp;RPC开发指南</a>
            
                
          
          </div>
        </div>
          
          
          
            <div class="dropdown main-nav-link"><a class="main-nav-link" href="#"><i class="fa fa-brands fa-rust">&nbsp;</i>Rust学习资源</a>
              <div class="dropdown-content">
          
            
              <a href="/perf-book"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust高性能编程指南</a>
            
                
          
            
              <a href="/rust100"><i class="fa fa-brands fa-rust"></i>&nbsp;100个练习题学习Rust</a>
            
                
          
            
              <a href="/atomics"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust原子操作和锁</a>
            
                
          
            
              <a href="/effective-rust"><i class="fa fa-brands fa-rust"></i>&nbsp;高效Rust编程</a>
            
                
          
            
              <a href="/thebook"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust程序设计语言</a>
            
                
          
            
              <a href="/nomicon"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust死灵书</a>
            
                
          
            
              <a href="/rust-reference"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust参考手册</a>
            
                
          
            
              <a href="/tlborm"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust宏小册</a>
            
                
          
            
              <a href="/async-book"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust异步编程书</a>
            
                
          
            
              <a href="/rust-by-example"><i class="fa fa-brands fa-rust"></i>&nbsp;通过例子学Rust</a>
            
                
          
            
              <a href="/api-guidelines"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust API 编写指南</a>
            
                
          
            
              <a href="/comprehensive-rust"><i class="fa fa-brands fa-rust"></i>&nbsp;全面Rust课程</a>
            
                
          
            
              <a href="/easy-rust"><i class="fa fa-brands fa-rust"></i>&nbsp;简单英语学Rust</a>
            
                
          
            
              <a href="/rust-patterns"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust设计模式</a>
            
                
          
            
              <a href="/2020/03/05/A-half-hour-to-learn-Rust/"><i class="fa fa-brands fa-rust"></i>&nbsp;半小时学会Rust</a>
            
                
          
            
              <a href="/rust-cookbook"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust实用指南(cookbook)</a>
            
                
          
            
              <a href="/rust-rand"><i class="fa fa-brands fa-rust"></i>&nbsp;Rust随机库</a>
            
                
          
            
              <hr>
            
                
          
            
              <a href="https://rpcx.io/r/E6v8U"><i class="fa undefined"></i>&nbsp;Rust for the Polyglot Programmer</a>
            
                
          
            
              <a href="https://rpcx.io/r/oC5ii"><i class="fa undefined"></i>&nbsp;LifetimeKata</a>
            
                
          
            
              <a href="https://tfpk.github.io/macrokata/"><i class="fa undefined"></i>&nbsp;macrokata</a>
            
                
          
          </div>
        </div>
          
          
          
            <div class="dropdown main-nav-link"><a class="main-nav-link" href="#"><i class="fa undefined">&nbsp;</i>出版书籍</a>
              <div class="dropdown-content">
          
            
              <a href="/ScalaCollectionsCookbook"><i class="fa undefined"></i>&nbsp;Scala集合技术手册（简/繁）</a>
            
                
          
            
              <a href="https://cpgo.colobu.com/"><i class="fa undefined"></i>&nbsp;深入理解Go并发编程（简/繁）</a>
            
                
          
            
              <a href="https://item.jd.com/14347716.html"><i class="fa undefined"></i>&nbsp;100个Go语言典型错误</a>
            
                
          
          </div>
        </div>
          
          
          
            <a class="main-nav-link" href="../../../../ScalaCollectionsCookbook"><i class="fa fa-solid fa-book">&nbsp;</i>Scala集合技术手册</a>
          
          
          
            <a class="main-nav-link" href="../../../../about"><i class="fa fa-regular fa-address-card">&nbsp;</i>关于</a>
          
          


      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="https://www.google.com/search" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" id="search-word" name="q" maxlength="20" class="search-form-input" placeholder="Search">
          <input type=hidden name=ie value="utf-8">
          <input type=hidden name=oe value="utf-8">
          <input type=hidden name=hl value="zh-CN">
          <input type="submit" id="search-submit" value="" class="search-form-submit">
        </form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-rust-async-sync" class="article article-type-post" itemscope
  itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2024-08-28T00:30:43.000Z" itemprop="datePublished">2024年08月28日</time>
</a>
    
    
  <div class="article-author"> by smallnest</div>

  </div>
  <div class="article-inner">
    
    
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      在 Rust 中同时支持异步和同步代码
	  
    </h1>
  

    </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      
      
      <script>function show_answer(btn, x) { if (btn.value === "显示答案") { btn.value = "隐藏答案" } else { btn.value = "显示答案" } var as = document.getElementById(x); if (as.style.display === "none") { as.style.display = "block" } else { as.style.display = "none" } }</script>
      <p>来，过路人，请坐到我身边来，听老衲讲一讲我对 Rust 过分要求的故事。</p>
<a id="more"></a>
<h2 id="介绍">介绍</h2>
<p>想象一下,你打算用Rust创建一个新库。这个库的唯一功能就是封装一个你需要的公共API, 比如 <a href="https://developer.spotify.com/documentation/web-api/" target="_blank" rel="external">Spotify API或者</a> <a href="https://www.arangodb.com/" target="_blank" rel="external">ArangoDB</a> 之类的数据库。这并不是造火箭，你也不是在发明什么新东西或者处理复杂的算法,所以你认为这应该相对简单直接。</p>
<p>你决定用异步方式实现这个库。你的库中大部分工作都涉及执行HTTP请求,主要是I/O操作,所以使用异步是有道理的(而且,这也是Rust圈里现在的潮流)。你开始编码,几天后就准备好了v0.1.0版本。当 <code>cargo publish</code> 成功完成并将你的作品上传到 <code>crates.io</code> 时,你暗自得意地想: &quot;不错嘛&quot;。</p>
<p>几天过去了,你在GitHub上收到了一个新通知。有人提了一个问题:</p>
<blockquote>
<p><strong>我如何同步使用这个库？</strong></p>
<p>我的项目不使用异步,因为对我的需求来说太复杂了。我想尝试你的新库,但不确定怎么轻松地使用它。我不想在代码中到处使用 <code>block_on(endpoint())</code>。。我见过像 <a href="https://crates.io/crates/reqwest" target="_blank" rel="external"><code>reqwest</code></a> 这样的 crate导出一个 <a href="https://docs.rs/reqwest/0.11.4/reqwest/blocking/index.html" target="_blank" rel="external"><code>blocking</code>模块</a>，提供完全相同的功能,你能不能也这么做?</p>
</blockquote>
<p>从底层来看,这听起来是个很复杂的任务。为异步代码(需要像 <a href="https://crates.io/crates/tokio" target="_blank" rel="external"><code>tokio</code></a> 这样的运行时、awaiting future、pinning等)和普通的同步代码提供一个通用接口?好吧,既然他们提出请求的态度很好,也许我们可以试试。毕竟,代码中唯一的区别就是 <code>async</code> 和 <code>await</code> 关键字的出现,因为你没有做什么花哨的事情。</p>
<p>好吧，这或多或少就是crate 发生的事情 <a href="https://crates.io/crates/rspotify" target="_blank" rel="external"><code>rspotify</code></a> ，我曾经和它的创建者 <a href="https://github.com/ramsayleung/" target="_blank" rel="external">Ramsay</a> 一起维护它。对于那些不知道的人来说，它是 Spotify Web API 的一个包装器。对不了解的人来说,这是一个Spotify Web API的封装。说明一下,我最终确实实现了这个功能,尽管不如我希望的那么干净利落;我会在Rspotify系列的这篇新文章中试图解释这个<a href="https://nullderef.com/series/rspotify" target="_blank" rel="external">情况</a>。</p>
<h2 id="第一种方法">第一种方法</h2>
<p>为了提供更多背景信息，Rspotify 的客户端大致如下：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Spotify { <span class="comment">/* ... */</span> }</div><div class="line"></div><div class="line"><span class="keyword">impl</span> Spotify {</div><div class="line">    async <span class="function"><span class="keyword">fn</span> <span class="title">some_endpoint</span></span>(&<span class="keyword">self</span>, param: String) -&gt; SpotifyResult&lt;String&gt; {</div><div class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> params = HashMap::new();</div><div class="line">        params.insert(<span class="string">"param"</span>, param);</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.http.get(<span class="string">"/some-endpoint"</span>, params).await</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>本质上，我们需要让 <code>some_endpoint</code> 同时支持异步和阻塞两种使用方式。这里的关键问题是，当你有几十个端点时，你该如何实现这一点？而且，你怎样才能让用户在异步和同步之间轻松切换呢？</p>
<h3 id="老掉牙的复制粘贴大法">老掉牙的复制粘贴大法</h3>
<p>这是最初实现的方法。它相当简单，而且确实能用。你只需要把常规的客户端代码复制到 Rspotify 的一个新的 <a href="https://github.com/ramsayleung/rspotify/tree/v0.9/src/blocking" target="_blank" rel="external"><code>blocking</code>模块</a>里。<a href="https://docs.rs/reqwest" target="_blank" rel="external"><code>reqwest</code></a>（我们用的 HTTP 客户端）和 <code>reqwest::blocking</code> 共用一个接口，所以我们可以在新模块里手动删掉 <code>async</code> 或 <code>.await</code> 这样的关键字，然后把 <code>reqwest</code> 的导入改成 <code>reqwest::blocking</code>。</p>
<p>这样一来，Rspotify 的用户只需要用 <code>rspotify::blocking::Client</code> 替代 <code>rspotify::Client</code>，瞧！他们的代码就变成阻塞式的了。这会让只用异步的用户的二进制文件变大，所以我们可以把它放在一个叫 <code>blocking</code> 的特性开关后面，大功告成。</p>
<p>不过，问题后来就变得明显了。整个 crate 的一半代码都被复制了一遍。添加或修改一个端点就意味着要写两遍或删两遍所有东西。</p>
<p>除非你把所有东西都测试一遍，否则没法确保两种实现是等效的。这主意倒也不坏，但说不定你连测试都复制粘贴错了呢！那可怎么办？可怜的代码审查员得把同样的代码读两遍，确保两边都没问题 —— 这听起来简直就是人为错误的温床。</p>
<p>根据我们的经验，这确实大大拖慢了 Rspotify 的开发进度，尤其是对于不习惯这种折腾的新贡献者来说。作为 Rspotify 的一个新晋且热情的维护者，我开始<a href="https://github.com/ramsayleung/rspotify/issues/112" target="_blank" rel="external">研究其他可能的解决方案</a>。</p>
<h3 id="召唤_block_on">召唤 <code>block_on</code></h3>
<p><a href="https://github.com/ramsayleung/rspotify/pull/120" target="_blank" rel="external">第二种方法</a>是把所有东西都在异步那边实现。然后，你只需为阻塞接口做个包装，在内部调用 <code>block_on</code>。<code>block_on</code> 会运行 future 直到完成，本质上就是把它变成同步的。你仍然需要复制方法的定义，但实现只需写一次：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">mod</span> blocking {</div><div class="line">    <span class="keyword">struct</span> Spotify(super::Spotify);</div><div class="line"></div><div class="line">    <span class="keyword">impl</span> Spotify {</div><div class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>(&<span class="keyword">self</span>, param: String) -&gt; SpotifyResult&lt;String&gt; {</div><div class="line">            runtime.block_on(async move {</div><div class="line">                <span class="keyword">self</span>.<span class="number">0</span>.endpoint(param).await</div><div class="line">            })</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>请注意，为了调用<code>block_on</code>，您首先必须在端点方法中创建某种运行时。例如，使用<a href="https://crates.io/crates/tokio" target="_blank" rel="external"><code>tokio</code></a> ：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> <span class="keyword">mut</span> runtime = tokio::runtime::Builder::new()</div><div class="line">    .basic_scheduler()</div><div class="line">    .enable_all()</div><div class="line">    .build()</div><div class="line">    .unwrap();</div></pre></td></tr></table></figure>

<p>这就引出了一个问题：我们是应该在每次调用端点时都初始化运行时，还是有办法共享它呢？我们可以把它保存为一个全局变量（<em>呃，真恶心</em>），或者更好的方法是，我们可以把运行时保存在 <code>Spotify</code> 结构体中。但是由于它需要对运行时的可变引用，你就得用 <code>Arc&lt;Mutex&lt;T&gt;&gt;</code> 把它包起来，这样一来就完全扼杀了客户端的并发性。正确的做法是使用 Tokio 的 <a href="https://docs.rs/tokio/latest/tokio/runtime/struct.Handle.html" target="_blank" rel="external"><code>Handle</code></a>，大概是这样的：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> tokio::runtime::Runtime;</div><div class="line"></div><div class="line">lazy_static! { <span class="comment">// You can also use `once_cell`</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">ref</span> RT: Runtime = Runtime::new().unwrap();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>(&<span class="keyword">self</span>, param: String) -&gt; SpotifyResult&lt;String&gt; {</div><div class="line">    RT.handle().block_on(async move {</div><div class="line">        <span class="keyword">self</span>.<span class="number">0</span>.endpoint(param).await</div><div class="line">    })</div><div class="line">}</div></pre></td></tr></table></figure>

<p>虽然使用 handle 确实让我们的阻塞客户端更快了<a href="https://nullderef.com/blog/rust-async-sync/#block-on-perf" target="_blank" rel="external">^1</a>，但还有一种性能更高的方法。如果你感兴趣的话，这正是 <code>reqwest</code> 自己采用的方法。简单来说，它会生成一个线程，这个线程调用 <code>block_on</code> 来等待一个装有任务的通道 [^2] (<a href="https://nullderef.com/blog/rust-async-sync/#block-on-channels" target="_blank" rel="external">https://nullderef.com/blog/rust-async-sync/#block-on-channels</a>) [^3] (<a href="https://nullderef.com/blog/rust-async-sync/#block-on-reqwest)。" target="_blank" rel="external">https://nullderef.com/blog/rust-async-sync/#block-on-reqwest)。</a></p>
<p>不幸的是，这个解决方案仍然有相当大的开销。你需要引入像 <code>futures</code> 或 <code>tokio</code> 这样的大型依赖，并将它们包含在你的二进制文件中。所有这些，就是为了...最后还是写出阻塞代码。所以这不仅在运行时有成本，在编译时也是如此。这在我看来就是不对劲。</p>
<p>而且你仍然有不少重复代码，即使只是定义，积少成多也是个问题。<code>reqwest</code> 是一个巨大的项目，可能负担得起他们的 <code>blocking</code> 模块的开销。但对于像 <code>rspotify</code> 这样不那么流行的 crate 来说，这就难以实现了。</p>
<h3 id="复制_crate">复制 crate</h3>
<p>另一种可能的解决方法是，正如 features 文档所建议的那样，创建独立的 crate。我们可以有 <code>rspotify-sync</code> 和 <code>rspotify-async</code>，用户可以根据需要选择其中一个作为依赖，甚至如果需要的话可以两个都用。问题是 —— 又来了 —— 我们究竟该如何生成这两个版本的 crate 呢？即使使用 Cargo 的一些技巧，比如为每个 crate 准备一个 <code>Cargo.toml</code> 文件（这种方法本身就很不方便），我也无法在<a href="https://github.com/ramsayleung/rspotify/pull/253" target="_blank" rel="external">不复制粘贴</a>整个 crate 的情况下做到这一点。</p>
<p>采用这种方法，我们甚至无法使用过程宏，因为你不能在宏中凭空创建一个新的 crate。我们可以定义一种文件格式来编写 Rust 代码的模板，以便替换代码中的某些部分，比如 <code>async</code>/<code>.await</code>。但这听起来完全超出了我们的范畴。</p>
<h2 id="最终版是：maybe_async_crate">最终版是：<code>maybe_async</code> crate</h2>
<p><a href="https://github.com/ramsayleung/rspotify/pull/129" target="_blank" rel="external">第三次尝试</a>基于一个名为 <a href="https://crates.io/crates/maybe_async" target="_blank" rel="external"><code>maybe_async</code></a> 的 crate。我记得当初发现它时，天真地以为这就是完美的解决方案。</p>
<p>总之，这个 crate 的思路是，你可以用一个过程宏自动移除代码中的 <code>async</code> 和 <code>.await</code>，本质上就是把复制粘贴的方法自动化了。举个例子：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[maybe_async::maybe_async]</span></div><div class="line">async <span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>() { <span class="comment">/* stuff */</span> }</div></pre></td></tr></table></figure>

<p>生成以下代码：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[cfg(not(feature = "is_sync"))]</span></div><div class="line">async <span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>() { <span class="comment">/* stuff */</span> }</div><div class="line"></div><div class="line"><span class="preprocessor">#[cfg(feature = "is_sync")]</span></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>() { <span class="comment">/* stuff with `.await` removed */</span> }</div></pre></td></tr></table></figure>

<p>你可以通过在编译 crate 时切换 <code>maybe_async/is_sync</code> 特性来配置是要异步还是阻塞代码。这个宏适用于函数、trait 和 <code>impl</code> 块。如果某个转换不像简单地移除 <code>async</code> 和 <code>.await</code> 那么容易，你可以用 <code>async_impl</code> 和 <code>sync_impl</code> 过程宏来指定自定义实现。它处理得非常好，我们在 Rspotify 中已经使用它一段时间了。</p>
<p>事实上，它效果如此之好，以至于我让 Rspotify 变成了HTTP 客户端无关的，这比异步/同步无关更加灵活。这使我们能够支持多种 HTTP 客户端，比如 <a href="https://crates.io/crates/reqwest" target="_blank" rel="external"><code>reqwest</code></a> 和 <a href="https://crates.io/crates/ureq" target="_blank" rel="external"><code>ureq</code></a> ，而不用管客户端是异步的还是同步的。</p>
<p>如果你有 <code>maybe_async</code>，实现<em>HTTP 客户端无关</em>并不是很难。你只需要为 <a href="https://github.com/ramsayleung/rspotify/blob/89b37219a2230cdcf08c4cfd2ebe46d64902f03d/rspotify-http/src/common.rs#L46" target="_blank" rel="external">HTTP 客户端</a>定义一个 trait，然后为你想支持的每个客户端实现它：</p>
<p><em>一段代码胜过千言万语。（你可以在这里找到 Rspotify 的 <a href="https://github.com/ramsayleung/rspotify/blob/master/rspotify-http/src/reqwest.rs#L97" target="_blank" rel="external"><code>reqwest</code>客户端</a>的完整源代码， <code>ureq</code> 也可以在<a href="https://github.com/ramsayleung/rspotify/blob/master/rspotify-http/src/ureq.rs#L56" target="_blank" rel="external">这里</a>找到 ）</em></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[maybe_async]</span></div><div class="line"><span class="keyword">trait</span> <span class="title">HttpClient</span> {</div><div class="line">    async <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&<span class="keyword">self</span>) -&gt; String;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#[sync_impl]</span></div><div class="line"><span class="keyword">impl</span> HttpClient <span class="keyword">for</span> UreqClient {</div><div class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&<span class="keyword">self</span>) -&gt; String { ureq::get(<span class="comment">/* ... */</span>) }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#[async_impl]</span></div><div class="line"><span class="keyword">impl</span> HttpClient <span class="keyword">for</span> ReqwestClient {</div><div class="line">    async <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&<span class="keyword">self</span>) -&gt; String { reqwest::get(<span class="comment">/* ... */</span>).await }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct</span> SpotifyClient&lt;Http: HttpClient&gt; {</div><div class="line">    http: Http</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#[maybe_async]</span></div><div class="line"><span class="keyword">impl</span>&lt;Http: HttpClient&gt; SpotifyClient&lt;Http&gt; {</div><div class="line">    async <span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>(&<span class="keyword">self</span>) { <span class="keyword">self</span>.http.get(<span class="comment">/* ... */</span>) }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>然后，我们可以进一步扩展，让用户通过在他们的 <code>Cargo.toml</code> 中设置特性标志来选择他们想要使用的客户端。比如，如果启用了 <code>client-ureq</code>，由于 <code>ureq</code> 是同步的，它就会启用 <code>maybe_async/is_sync</code>。这样一来，就会移除 <code>async</code>/<code>.await</code> 和 <code>#[async_impl]</code> 块，Rspotify 客户端内部就会使用 <code>ureq</code> 的实现。</p>
<p>这个解决方案避免了我之前提到的所有缺点：</p>
<ul>
<li>完全没有代码重复</li>
<li>无论是在运行时还是编译时都没有额外开销。如果用户想要一个阻塞客户端，他们可以使用 <code>ureq</code>，这样就不会引入 <code>tokio</code> 及其相关依赖</li>
<li>对用户来说很容易理解；只需在 <code>Cargo.toml</code> 中配置一个标志</li>
</ul>
<p>不过，先停下来想几分钟，试试看你能不能找出为什么不应该这么做。实际上，我给你9个月时间，这就是我花了多长时间才意识到问题所在...</p>
<h3 id="问题">问题</h3>
<p><img src="https://nullderef.com/blog/rust-async-sync/preview.jpg" alt="预览"></p>
<p>嗯，问题在于 Rust 中的特性必须是<strong>叠加的</strong>：&quot;启用一个特性不应该禁用功能，而且通常应该可以安全地启用任意组合的特性&quot;。当依赖树中出现重复的 crate 时，Cargo 可能会合并该 crate 的特性，以避免多次编译同一个 crate。<a href="https://doc.rust-lang.org/cargo/reference/features.html#feature-unification" target="_blank" rel="external">如果您想了解更多详细信息，参考资料对此进行了很好的解释</a>。</p>
<p>这种优化意味着互斥的特性可能会破坏依赖树。在我们的情况下，<code>maybe_async/is_sync</code> 是一个由 <code>client-ureq</code> 启用的 切换特性。所以如果你试图同时启用 <code>client-reqwest</code> 来编译，它就会失败，因为 <code>maybe_async</code> 将被配置为生成同步函数签名。不可能有一个 crate 直接或间接地同时依赖于同步和异步的 Rspotify，而且根据 Cargo 参考文档，<code>maybe_async</code> 的整个概念目前是错误的。</p>
<h3 id="新特性解析器_v2">新特性解析器 v2</h3>
<p>一个常见的误解是，这个问题可以通过&quot;特性解析器v2&quot;来修复，<a href="https://doc.rust-lang.org/cargo/reference/features.html#feature-resolver-version-2" target="_blank" rel="external">参考文档也对此进行了很好的解释</a>。从2021版本开始，这个新版本已经默认启用了，但你也可以在之前的版本的 <code>Cargo.toml</code> 中指定使用它。这个新版本除了其他改进，还在一些特殊情况下避免了特性的统一，但不包括我们的情况：</p>
<ul>
<li>对于当前未在构建的目标，启用在平台特定依赖项上的特性会被忽略。</li>
<li>构建依赖和过程宏不会与普通依赖共享特性。</li>
<li>除非构建需要它们的目标（如测试或示例），否则开发依赖不会激活特性。</li>
</ul>
<p>为了以防万一，我自己尝试复现了这个问题，结果确实如我所料。<a href="https://github.com/marioortizmanero/resolver-v2-conflict" target="_blank" rel="external">这个代码库</a>是一个特性冲突的例子，在任何特性解析器下都会出错。</p>
<h3 id="其他失败">其他失败</h3>
<p>有一些 crate也存在这个问题：</p>
<ul>
<li><p><a href="https://crates.io/crates/arangors" target="_blank" rel="external"><code>arangors</code></a> 和 <a href="https://crates.io/crates/aragog" target="_blank" rel="external"><code>aragog</code></a> ：ArangoDB 的包装器。两者都用于 <code>maybe_async</code> 在异步和同步之间切换（<code>arangors</code> 事实上，的作者是同一个人）<a href="https://nullderef.com/blog/rust-async-sync/#arangors-error" target="_blank" rel="external">^5</a> [^6] (<a href="https://nullderef.com/blog/rust-async-sync/#aragog-error)。" target="_blank" rel="external">https://nullderef.com/blog/rust-async-sync/#aragog-error)。</a></p>
</li>
<li><p><a href="https://crates.io/crates/inkwell" target="_blank" rel="external"><code>inkwell</code></a> ：LLVM 的包装器。它支持多个版本的 LLVM，但彼此之间不兼容<a href="https://nullderef.com/blog/rust-async-sync/#inkwell-error" target="_blank" rel="external">[7]</a>。</p>
</li>
<li><p><a href="https://crates.io/crates/k8s-openapi" target="_blank" rel="external"><code>k8s-openapi</code></a> ：Kubernetes 的包装器，与 <code>inkwell</code> <a href="https://nullderef.com/blog/rust-async-sync/#k8s-error" target="_blank" rel="external">^8</a>存在同样的问题。</p>
</li>
</ul>
<h3 id="修复_maybe_async">修复 <code>maybe_async</code></h3>
<p>随着这个 crate 开始变得流行起来，有人在 <code>maybe_async</code> 中提出了这个问题，解释了情况并展示了一个修复方案：<br> <a href="https://github.com/fMeow/maybe-async-rs/issues/6" target="_blank" rel="external">async 和 sync 在同一程序中 fMeow/maybe-async-rs #6</a></p>
<p><code>maybe_async</code> 现在会有两个特性标志：<code>is_sync</code> 和 <code>is_async</code>。这个 crate 会以同样的方式生成函数，但会在标识符后面添加 <code>_sync</code> 或 <code>_async</code> 后缀，这样就不会冲突了。例如：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[maybe_async::maybe_async]</span></div><div class="line">async <span class="function"><span class="keyword">fn</span> <span class="title">endpoint</span></span>() { <span class="comment">/* stuff */</span> }</div></pre></td></tr></table></figure>

<p>现在将生成以下代码：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#[cfg(feature = "is_async")]</span></div><div class="line">async <span class="function"><span class="keyword">fn</span> <span class="title">endpoint_async</span></span>() { <span class="comment">/* stuff */</span> }</div><div class="line"></div><div class="line"><span class="preprocessor">#[cfg(feature = "is_sync")]</span></div><div class="line"><span class="function"><span class="keyword">fn</span> <span class="title">endpoint_sync</span></span>() { <span class="comment">/* stuff with `.await` removed */</span> }</div></pre></td></tr></table></figure>

<p>然而，这些后缀会引入噪音，所以我在想是否有可能以更符合人体工程学的方式来实现。我fork了<code>maybe_async</code>并尝试了一下，你可以在这一系列评论中读到更多相关内容。总的来说，这太复杂了，我最终放弃了。</p>
<p>修复这个边缘情况的唯一方法就是让Rspotify对所有人的可用性变差。但我认为，同时依赖异步和同步版本的人可能很少；实际上我们还没有收到任何人的抱怨。与<code>reqwest</code>不同，<code>rspotify</code>是一个&quot;高级&quot;库，所以很难想象它会在一个依赖树中出现多次。</p>
<p>也许我们可以向Cargo的开发者寻求帮助？</p>
<h3 id="官方支持">官方支持</h3>
<p>虽然不是官方的，但 Rust 中可以进一步探索的另一种有趣方法是<a href="https://sans-io.readthedocs.io/" target="_blank" rel="external">“Sans I/O”</a>。这是一个 Python 协议，它抽象了网络协议（如 HTTP）的使用，从而最大限度地提高了可重用性。Rust 中现有的一个示例是 <a href="https://github.com/EmbarkStudios/tame-oidc" target="_blank" rel="external"><code>tame-oidc</code></a>。</p>
<p>Rspotify 远不是第一个遇到这个问题的项目，所以阅读之前的相关讨论可能会很有趣：</p>
<ul>
<li><a href="https://github.com/rust-lang/rfcs/pull/2962" target="_blank" rel="external">这个现已关闭的 Rust 编译器 RFC</a> 添加 <code>oneof</code> 配置谓词（类似 <code>#[cfg(any(…))]</code>）来支持互斥特性。这只是让在别无选择的情况下拥有冲突特性变得更容易，但特性仍应该是严格叠加的。</li>
<li>前一个 RFC 在 Cargo 本身允许互斥特性的背景下引发了<a href="https://internals.rust-lang.org/t/pre-rfc-cargo-mutually-exclusive-features/13182/27" target="_blank" rel="external">一些讨论</a>，尽管有一些有趣的信息，但并没有取得太大进展。</li>
<li><a href="https://github.com/rust-lang/cargo/issues/2980" target="_blank" rel="external">Cargo 中的这个问题</a> 解释了 Windows API 的类似情况。讨论包括更多示例和解决方案想法，但还没有被 Cargo 采纳。</li>
<li><a href="https://github.com/rust-lang/cargo/issues/4803" target="_blank" rel="external">Cargo 中的另一个问题</a> 要求提供一种方法来轻松测试和构建不同标志组合。如果特性是严格叠加的，那么 <code>cargo test --all-features</code> 将涵盖所有情况。但如果不是，用户就必须用多个特性标志组合运行命令，这相当麻烦。非官方的 <a href="https://github.com/taiki-e/cargo-hack" target="_blank" rel="external"><code>cargo-hack</code></a> 已经可以实现这一点。</li>
<li>一种完全不同的方法 <a href="https://blog.rust-lang.org/inside-rust/2023/02/23/keyword-generics-progress-report-feb-2023.html" target="_blank" rel="external">基于关键字泛型倡议</a>。这似乎是解决这个问题的最新尝试，但仍处于&quot;探索&quot;阶段， <a href="https://blog.rust-lang.org/inside-rust/2022/07/27/keyword-generics.html#q-is-there-an-rfc-available-to-read" target="_blank" rel="external">截至目前还没有可用的 RFC</a>。</li>
</ul>
<p>根据<a href="https://github.com/rust-lang/rfcs/pull/2962#issuecomment-664656377" target="_blank" rel="external">这条旧评论</a>，这不是 Rust 团队已经否决的东西；它仍在讨论中。</p>
<p>虽然是非官方的，但另一个可以在 Rust 中进一步探索的另一种有趣方法是 <a href="https://sans-io.readthedocs.io/" target="_blank" rel="external">“Sans I/O”</a>。这是一种 Python 协议，它在我们的案例中抽象了 HTTP 等网络协议的使用，从而最大化了可重用性。Rust 中现有的一个例子是 <a href="https://github.com/EmbarkStudios/tame-oidc" target="_blank" rel="external"><code>tame-oidc</code></a>。</p>
<h2 id="结论">结论</h2>
<p>我们目前面临以下选择：</p>
<ul>
<li>忽视 Cargo 参考。我们可以假设没有人会同时使用 Rspotify 的同步和异步版本。</li>
<li>修复 <code>maybe_async</code> 并为我们库中的每个端点添加 <code>_async</code> 和 <code>_sync</code> 后缀。</li>
<li>放弃支持异步和同步代码。这已经变成了一团糟，我们没有足够的人力来处理，而且它影响了 Rspotify 的其他部分。问题是一些依赖 rspotify 的 crate，如 <code>ncspot</code> 或 <code>spotifyd</code> 是阻塞的，而其他如 <code>spotify-tui</code> 使用异步，所以我不确定他们会怎么想。</li>
</ul>
<p>我知道这是我给自己强加的问题。我们可以直接说&quot;不。我们只支持异步&quot;或&quot;不。我们只支持同步&quot;。虽然有用户对能够使用两者感兴趣，但有时你就是得说不。如果这样一个特性变得如此复杂，以至于你的整个代码库变成一团糟，而你没有足够的工程能力来维护它，那这就是你唯一的选择。如果有人真的很在意，他们可以直接 fork 这个 crate 并将其转换为同步版本供自己使用。</p>
<p>毕竟，大多数 API 封装库等只支持异步或阻塞代码中的一种。例如，<a href="https://crates.io/crates/serenity" target="_blank" rel="external"><code>serenity</code></a> （Discord API）、<a href="https://crates.io/crates/sqlx" target="_blank" rel="external"><code>sqlx</code></a> （SQL 工具包）和 <a href="https://crates.io/crates/teloxide" target="_blank" rel="external"><code>teloxide</code></a> （Telegram API）是仅异步的，而且它们非常流行。。</p>
<p>尽管有时候很沮丧，但我并不后悔花了这么多时间兜圈子试图让异步和同步都能工作。我最初为 Rspotify 做贡献就是为了_学习<em>。我没有截止日期，也没有压力，我只是想在空闲时间尝试改进 Rust 中的一个库。而且我确实</em>学到了_很多；希望在读完这篇文章后，你也是如此。</p>
<p>也许今天的教训是，我们应该记住 Rust 毕竟是一种低级语言，有些事情如果不引入大量复杂性是不可能实现的。无论如何，我期待 Rust 团队将来如何解决这个问题。</p>
<p>那么你怎么看？如果你是 Rspotify 的维护者，你会怎么做？如果你愿意，可以在下面留言。</p>

      
    </div>
    <footer class="article-footer">
      

      
      <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script> -->
      <section id="comments">
        <script src="https://utteranc.es/client.js"
                repo="smallnest/gitalk"
                issue-term="title"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        <!-- <div id="gitalk-container"></div>
        <script type="text/javascript">
          var gitalkOpts = {
            id: '2024/08/28/rust-async-sync/',
            owner: 'smallnest',
            repo: 'gitalk',
            title: '在 Rust 中同时支持异步和同步代码',
            body: 'https://colobu.com/2024/08/28/rust-async-sync/',
            clientID: 'bc02724130ed5b7ee275',
            clientSecret: '68cb0bae2f93a8b88b09e0eb9b08c844b06a9047',
            admin: ['smallnest'],
            distractionFreeMode: false
          };

          const gitalk = new Gitalk(gitalkOpts)
          gitalk.render('gitalk-container')
        </script> -->
        <noscript> 为正常使用评论功能请激活JavaScript</noscript>
      </section>

      

    </footer>
  </div>
  
  
<nav id="article-nav">
  
    <a href="../../../10/20/go-internal-ds-spmc" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Go中秘而不宣的数据结构 spmc, 10倍性能于 channel
        
      </div>
    </a>
  
  
    <a href="../../13/string-bytes-benchmark" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">四种字符串和bytes互相转换方式的性能比较</div>
    </a>
  
</nav>

  
</article></section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">访问者来源</h3>
  <div class="widget">
    <script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=Hf4EJSi2XvL6TMcuFSH51Qn6nf5nZ8qnjVBnWCQ4FGc"></script>
  </div>
</div>

<div class="widget-wrap">
  <h3 class="widget-title">微信公众号</h3>
  <div class="widget">
    <img width="100%" src="/images/widgets/gopatterns.jpg">
  </div>
</div>

<div class="widget-wrap">
  <h3 class="widget-title">极客时间专栏</h3>
  <div class="widget">
    <a href="https://time.geekbang.org/column/intro/100061801">
      <img width="100%" src="/images/widgets/geekbang.png">
    </a>
  </div>
</div>

<div class="widget-wrap">
    <h3 class="widget-title">出版图书</h3>
    <div class="widget">
      <a href="https://cpgo.colobu.com/">
        <img width="100%" src="/cpgolang/cpgo.png">
      </a>
    </div>
    <div class="widget">
      <a href="https://www.books.com.tw/products/0010991366">
        <img width="100%" src="/cpgolang/cpgo2.jpg">
      </a>
    </div>
    <div class="widget">
      <a href="https://item.jd.com/14347716.html">
        <img width="100%" src="/100gomistakes/cover.png">
      </a>
    </div>
    <div class="widget">
      <a href="/ScalaCollectionsCookbook/">
        <img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook.jpg">
        <img width="100%" src="/ScalaCollectionsCookbook/scala_collections_cookbook_tw.png">
      </a>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Android">Android</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/C">C++</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/DOTNET">DOTNET</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Docker">Docker</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Go">Go</a><span class="category-list-count">301</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Java">Java</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Linux">Linux</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Rust">Rust</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Scala">Scala</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/go">go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/k8s">k8s</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/rust">rust</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/分享">分享</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/前端开发">前端开发</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/区块链">区块链</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/大数据">大数据</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/工具">工具</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/数据库">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/架构">架构</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/算法">算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/管理">管理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/网络编程">网络编程</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/设计模式">设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/读书笔记">读书笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/运维">运维</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/高并发编程">高并发编程</a><span class="category-list-count">20</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="../../../../tags/Android" style="font-size: 15.00px;">Android</a><a href="../../../../tags/ApacheBench" style="font-size: 11.25px;">ApacheBench</a><a href="../../../../tags/Bower" style="font-size: 10.00px;">Bower</a><a href="../../../../tags/C" style="font-size: 10.00px;">C#</a><a href="../../../../tags/CDN" style="font-size: 10.00px;">CDN</a><a href="../../../../tags/CQRS" style="font-size: 10.00px;">CQRS</a><a href="../../../../tags/CRC" style="font-size: 10.00px;">CRC</a><a href="../../../../tags/CSS" style="font-size: 11.25px;">CSS</a><a href="../../../../tags/CompletableFuture" style="font-size: 10.00px;">CompletableFuture</a><a href="../../../../tags/Comsat" style="font-size: 10.00px;">Comsat</a><a href="../../../../tags/Curator" style="font-size: 18.75px;">Curator</a><a href="../../../../tags/DSL" style="font-size: 10.00px;">DSL</a><a href="../../../../tags/Disruptor" style="font-size: 10.00px;">Disruptor</a><a href="../../../../tags/Docker" style="font-size: 11.25px;">Docker</a><a href="../../../../tags/Ember" style="font-size: 11.25px;">Ember</a><a href="../../../../tags/FastJson" style="font-size: 10.00px;">FastJson</a><a href="../../../../tags/Fiber" style="font-size: 10.00px;">Fiber</a><a href="../../../../tags/GAE" style="font-size: 10.00px;">GAE</a><a href="../../../../tags/GC" style="font-size: 12.50px;">GC</a><a href="../../../../tags/Gnuplot" style="font-size: 10.00px;">Gnuplot</a><a href="../../../../tags/Go" style="font-size: 16.25px;">Go</a><a href="../../../../tags/Gradle" style="font-size: 10.00px;">Gradle</a><a href="../../../../tags/Grunt" style="font-size: 10.00px;">Grunt</a><a href="../../../../tags/Gulp" style="font-size: 10.00px;">Gulp</a><a href="../../../../tags/Hadoop" style="font-size: 10.00px;">Hadoop</a><a href="../../../../tags/Hazelcast" style="font-size: 10.00px;">Hazelcast</a><a href="../../../../tags/IPFS" style="font-size: 10.00px;">IPFS</a><a href="../../../../tags/Ignite" style="font-size: 10.00px;">Ignite</a><a href="../../../../tags/JVM" style="font-size: 10.00px;">JVM</a><a href="../../../../tags/Java" style="font-size: 17.50px;">Java</a><a href="../../../../tags/Kafka" style="font-size: 20.00px;">Kafka</a><a href="../../../../tags/Lambda" style="font-size: 13.75px;">Lambda</a><a href="../../../../tags/Linux" style="font-size: 12.50px;">Linux</a><a href="../../../../tags/LongAdder" style="font-size: 10.00px;">LongAdder</a><a href="../../../../tags/MathJax" style="font-size: 10.00px;">MathJax</a><a href="../../../../tags/Maven" style="font-size: 11.25px;">Maven</a><a href="../../../../tags/Memcached" style="font-size: 10.00px;">Memcached</a><a href="../../../../tags/Metrics" style="font-size: 10.00px;">Metrics</a><a href="../../../../tags/Mongo" style="font-size: 12.50px;">Mongo</a><a href="../../../../tags/Netty" style="font-size: 15.00px;">Netty</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2025/02">February 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2025/01">January 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/11">November 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/10">October 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/08">August 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/06">June 2024</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/05">May 2024</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/04">April 2024</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/03">March 2024</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/02">February 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/01">January 2024</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/12">December 2023</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/11">November 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/10">October 2023</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/09">September 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/08">August 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/07">July 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/06">June 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/05">May 2023</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/04">April 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/03">March 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/01">January 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/12">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/11">November 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/10">October 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/09">September 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/08">August 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/07">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/06">June 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/05">May 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/04">April 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/03">March 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/02">February 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/01">January 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/12">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/11">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/10">October 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/08">August 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/07">July 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/06">June 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/05">May 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/04">April 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/03">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/02">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/01">January 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/12">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/11">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/09">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/08">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/07">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/06">June 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/05">May 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/04">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/03">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/02">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/01">January 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/12">December 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/11">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/10">October 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/09">September 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/08">August 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/07">July 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/06">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/05">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/04">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/03">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/02">February 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2019/01">January 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/12">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/11">November 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/10">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/09">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/08">August 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/07">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/06">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/05">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/04">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/03">March 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/02">February 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/01">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/12">December 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/11">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/10">October 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/09">September 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/08">August 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/07">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/06">June 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/05">May 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/04">April 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/03">March 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/02">February 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/01">January 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/12">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/11">November 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/10">October 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/09">September 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/08">August 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/07">July 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/06">June 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/05">May 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/04">April 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/03">March 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/02">February 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2016/01">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/12">December 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/11">November 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/10">October 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/09">September 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/08">August 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/07">July 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/06">June 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/05">May 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/04">April 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/03">March 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/02">February 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2015/01">January 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/12">December 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/11">November 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/10">October 2014</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/09">September 2014</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/08">August 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2014/07">July 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../../../2025/02/01/the-state-of-simd-in-go">啥时候等到Go官方支持SIMD?</a>
          </li>
        
          <li>
            <a href="../../../../2025/01/31/scan-clickhouse-service">DeepSeek数据库暴露？扫描一下，应该不止此一家吧!</a>
          </li>
        
          <li>
            <a href="../../../../2025/01/30/some-notes-about-go-io-fs-package">趁着假期， 快速了解 Go io/fs 包</a>
          </li>
        
          <li>
            <a href="../../../../2025/01/27/how-long-to-scan-all-IPs-of-cn">扫描全国的公网IP需要多久？</a>
          </li>
        
          <li>
            <a href="../../../11/18/go-internal-ds-4-ary-heap">Go中秘而不宣的数据结构: 四叉堆，不是普通的二叉堆</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
			 
            <a href="http://stackshare.io" target="_blank">技术栈</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="https://toutiao.io/" target="_blank">开发者头条</a>
			
          </li>
        
          <li>
			 
            <a href="http://weekly.manong.io/issues/" target="_blank">码农周刊</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.tuicool.com/mags" target="_blank">编程狂人周刊</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.importnew.com/" target="_blank">importnew</a>
			
          </li>
        
          <li>
			 
            <a href="http://ifeve.com/" target="_blank">并发编程网</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="http://github.com" target="_blank">github</a>
			
          </li>
        
          <li>
			 
            <a href="http://stackoverflow.com/" target="_blank">stackoverflow</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.javacodegeeks.com/" target="_blank">javacodegeeks</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.infoq.com/" target="_blank">infoq</a>
			
          </li>
        
          <li>
			 
            <a href="http://www.dzone.com/links/index.html" target="_blank">dzone</a>
			
          </li>
        
          <li>
			 
            <a href="https://oj.leetcode.com/problems/" target="_blank">leetcode</a>
			
          </li>
        
          <li>
			 
            <a href="http://tutorials.jenkov.com" target="_blank">jenkov</a>
			
          </li>
        
          <li>
			 
            <a href="https://howtodoinjava.com" target="_blank">HowToDoInJava</a>
			
          </li>
        
          <li>
			 
            <a href="https://java-design-patterns.com/patterns/" target="_blank">java design patterns</a>
			
          </li>
        
          <li>
			 
			&nbsp;
			
          </li>
        
          <li>
			 
            <a href="https://medium.com/netflix-techblog" target="_blank">Netflix技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://www.techiedelight.com" target="_blank">Techie Delight</a>
			
          </li>
        
          <li>
			 
            <a href="https://engineering.linkedin.com/blog" target="_blank">Linkedin技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://blogs.dropbox.com/tech/" target="_blank">Dropbox技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://code.fb.com" target="_blank">Facebook技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="http://jm.taobao.org" target="_blank">淘宝中间件团队</a>
			
          </li>
        
          <li>
			 
            <a href="https://tech.meituan.com" target="_blank">美团技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="http://blogs.360.cn" target="_blank">360技术博客</a>
			
          </li>
        
          <li>
			 
            <a href="https://xiaomi-info.github.io" target="_blank">小米信息部技术团队</a>
			
          </li>
        
      </ul>
    </div>
  </div>

  
      

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 smallnest<br>
	  Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    
      <a href="../../../.." class="mobile-nav-link"><i class="fa fa-home">&nbsp;</i>首页</a>
    
  
    
      <a href="../../../../archives" class="mobile-nav-link"><i class="fa fa-regular fa-folder-open">&nbsp;</i>归档</a>
    
  
    
      <a href="https://github.com/smallnest" class="mobile-nav-link"><i class="fa fa-brands fa-github-alt">&nbsp;</i>github</a>
    
  
    
      <a class="mobile-nav-link" href="#"><i class="fa fa-brands fa-golang">&nbsp;</i>Go学习资源</a>
    
      
            <a class="mobile-nav-link" href="/goasm">&nbsp;&nbsp;<i class="fa fa-brands fa-golang">&nbsp;</i>Go汇编示例</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://gowebexamples.com">&nbsp;&nbsp;<i class="fa fa-brands fa-golang">&nbsp;</i>Go Web开发示例</a>
          
          
    
      
            <a class="mobile-nav-link" href="http://go-database-sql.org">&nbsp;&nbsp;<i class="fa fa-brands fa-golang">&nbsp;</i>Go 数据库开发教程</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://colobu.com/gotips/">&nbsp;&nbsp;<i class="fa fa-brands fa-golang">&nbsp;</i>Go 语言编程技巧</a>
          
          
    
      
            
          
          
    
      
            <a class="mobile-nav-link" href="http://rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPCX官网</a>
          
          
    
      
            <a class="mobile-nav-link" href="http://cn.doc.rpcx.io">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>RPC开发指南</a>
          
          
    
    
  
    
      <a class="mobile-nav-link" href="#"><i class="fa fa-brands fa-rust">&nbsp;</i>Rust学习资源</a>
    
      
            <a class="mobile-nav-link" href="/perf-book">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust高性能编程指南</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust100">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>100个练习题学习Rust</a>
          
          
    
      
            <a class="mobile-nav-link" href="/atomics">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust原子操作和锁</a>
          
          
    
      
            <a class="mobile-nav-link" href="/effective-rust">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>高效Rust编程</a>
          
          
    
      
            <a class="mobile-nav-link" href="/thebook">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust程序设计语言</a>
          
          
    
      
            <a class="mobile-nav-link" href="/nomicon">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust死灵书</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust-reference">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust参考手册</a>
          
          
    
      
            <a class="mobile-nav-link" href="/tlborm">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust宏小册</a>
          
          
    
      
            <a class="mobile-nav-link" href="/async-book">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust异步编程书</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust-by-example">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>通过例子学Rust</a>
          
          
    
      
            <a class="mobile-nav-link" href="/api-guidelines">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust API 编写指南</a>
          
          
    
      
            <a class="mobile-nav-link" href="/comprehensive-rust">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>全面Rust课程</a>
          
          
    
      
            <a class="mobile-nav-link" href="/easy-rust">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>简单英语学Rust</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust-patterns">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust设计模式</a>
          
          
    
      
            <a class="mobile-nav-link" href="/2020/03/05/A-half-hour-to-learn-Rust/">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>半小时学会Rust</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust-cookbook">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust实用指南(cookbook)</a>
          
          
    
      
            <a class="mobile-nav-link" href="/rust-rand">&nbsp;&nbsp;<i class="fa fa-brands fa-rust">&nbsp;</i>Rust随机库</a>
          
          
    
      
            
          
          
    
      
            <a class="mobile-nav-link" href="https://rpcx.io/r/E6v8U">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>Rust for the Polyglot Programmer</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://rpcx.io/r/oC5ii">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>LifetimeKata</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://tfpk.github.io/macrokata/">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>macrokata</a>
          
          
    
    
  
    
      <a class="mobile-nav-link" href="#"><i class="fa undefined">&nbsp;</i>出版书籍</a>
    
      
            <a class="mobile-nav-link" href="/ScalaCollectionsCookbook">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>Scala集合技术手册（简/繁）</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://cpgo.colobu.com/">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>深入理解Go并发编程（简/繁）</a>
          
          
    
      
            <a class="mobile-nav-link" href="https://item.jd.com/14347716.html">&nbsp;&nbsp;<i class="fa undefined">&nbsp;</i>100个Go语言典型错误</a>
          
          
    
    
  
    
      <a href="../../../../ScalaCollectionsCookbook" class="mobile-nav-link"><i class="fa fa-solid fa-book">&nbsp;</i>Scala集合技术手册</a>
    
  
    
      <a href="../../../../about" class="mobile-nav-link"><i class="fa fa-regular fa-address-card">&nbsp;</i>关于</a>
    
  
</nav>
    
<script src="//cdn.staticfile.org/jquery/1.11.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script>


<script src="../../../../js/script.js" type="text/javascript"></script>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>
<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.6.0-beta.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div id="totop" style="position:fixed;bottom:150px;right:10px;cursor: pointer;z-index: 2000;">
	<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="../../../../js/totop.js" type="text/javascript"></script>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e085d87993250aab11f3e0c15f1c2785";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </div>
</body>
</html>